

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>pex100.main &mdash; pex100 0.3.0 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="pex100 0.3.0 documentation" href="../../index.html"/>
        <link rel="up" title="Module code" href="../index.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> pex100
          

          
          </a>

          
            
            
              <div class="version">
                0.3.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <!-- Local TOC -->
                <div class="local-toc"></div>
            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">pex100</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../index.html">Module code</a> &raquo;</li>
      
    <li>pex100.main</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for pex100.main</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="c1">#</span>
<span class="c1">#  This file is part of the `pex100` Python module</span>
<span class="c1">#</span>
<span class="c1">#  Copyright (c) 2016-2017 - EMBL-EBI</span>
<span class="c1">#</span>
<span class="c1">#  File author(s): Dénes Türei (turei.denes@gmail.com)</span>
<span class="c1">#</span>
<span class="c1">#  Distributed under the GPLv3 License.</span>
<span class="c1">#  See accompanying file LICENSE.txt or copy at</span>
<span class="c1">#      http://www.gnu.org/licenses/gpl-3.0.html</span>
<span class="c1">#</span>
<span class="c1">#  Website: http://www.ebi.ac.uk/~denes</span>
<span class="c1">#</span>

<span class="kn">from</span> <span class="nn">future.utils</span> <span class="k">import</span> <span class="n">iteritems</span>
<span class="kn">from</span> <span class="nn">past.builtins</span> <span class="k">import</span> <span class="n">xrange</span><span class="p">,</span> <span class="nb">range</span><span class="p">,</span> <span class="n">reduce</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">imp</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">collections</span>
<span class="kn">import</span> <span class="nn">copy</span>

<span class="kn">import</span> <span class="nn">xlrd</span>
<span class="kn">import</span> <span class="nn">openpyxl</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">scipy</span> <span class="k">as</span> <span class="nn">sp</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">stats</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">import</span> <span class="nn">matplotlib.backends.backend_pdf</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">matplotlib_venn</span> <span class="k">as</span> <span class="nn">mplvenn</span>
<span class="k">except</span><span class="p">:</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">:: Could not import module `matplotlib_venn`.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">pypath</span>
<span class="k">except</span><span class="p">:</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">:: Could not import module `pypath`.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">pysemsim</span>
<span class="k">except</span><span class="p">:</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">:: Could not import module `pysemsim`.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">kinact</span>
<span class="k">except</span><span class="p">:</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">:: Could not import module `kinact`.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="k">if</span> <span class="s1">&#39;unicode&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">__builtins__</span><span class="p">:</span>
    <span class="n">unicode</span> <span class="o">=</span> <span class="nb">str</span>

<div class="viewcode-block" id="Pex100"><a class="viewcode-back" href="../../index.html#pex100.Pex100">[docs]</a><span class="k">class</span> <span class="nc">Pex100</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    
    <span class="n">lFcTableHdr</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;uniprot&#39;</span><span class="p">,</span>
            <span class="s1">&#39;genesymbol&#39;</span><span class="p">,</span>
            <span class="s1">&#39;name&#39;</span><span class="p">,</span>
            <span class="s1">&#39;resaa&#39;</span><span class="p">,</span>
            <span class="s1">&#39;resnum&#39;</span><span class="p">,</span>
            <span class="s1">&#39;label&#39;</span><span class="p">,</span>
            <span class="s1">&#39;original_resnum&#39;</span><span class="p">,</span>
            <span class="s1">&#39;effect&#39;</span><span class="p">,</span>
            <span class="s1">&#39;fc&#39;</span><span class="p">,</span>
            <span class="s1">&#39;logfc&#39;</span><span class="p">,</span>
            <span class="s1">&#39;zscore&#39;</span><span class="p">,</span>
            <span class="s1">&#39;pval&#39;</span><span class="p">,</span>
            <span class="s1">&#39;tval&#39;</span>
        <span class="p">]</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">dirBase</span> <span class="o">=</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span>
                 <span class="n">fnIdMapping</span> <span class="o">=</span> <span class="s1">&#39;PEX100_Layout.csv&#39;</span><span class="p">,</span>
                 <span class="n">fnXlsFullData</span> <span class="o">=</span> <span class="s1">&#39;AssayData-Cambridge-Peirce-150515.xlsx&#39;</span><span class="p">,</span>
                 <span class="n">fnCombined</span> <span class="o">=</span> <span class="s1">&#39;bmp8_</span><span class="si">%s</span><span class="s1">.csv&#39;</span><span class="p">,</span>
                 <span class="n">fnFcTable</span> <span class="o">=</span> <span class="s1">&#39;fc_</span><span class="si">%s</span><span class="s1">_</span><span class="si">%s</span><span class="s1">.csv&#39;</span><span class="p">,</span>
                 <span class="n">fnFcTopTable</span> <span class="o">=</span> <span class="s1">&#39;fctop_</span><span class="si">%s</span><span class="s1">_</span><span class="si">%s</span><span class="s1">.csv&#39;</span><span class="p">,</span>
                 <span class="n">fnFcUTable</span> <span class="o">=</span> <span class="s1">&#39;fctop_uniqp_</span><span class="si">%s</span><span class="s1">_</span><span class="si">%s</span><span class="s1">.csv&#39;</span><span class="p">,</span>
                 <span class="n">fnFcSUTable</span> <span class="o">=</span> <span class="s1">&#39;fctop_uniqp_sign_</span><span class="si">%s</span><span class="s1">_</span><span class="si">%s</span><span class="s1">.csv&#39;</span><span class="p">,</span>
                 <span class="n">fnFcTopCommon</span> <span class="o">=</span> <span class="s1">&#39;fctop_</span><span class="si">%s</span><span class="s1">.csv&#39;</span><span class="p">,</span>
                 <span class="n">fnFuncCat</span> <span class="o">=</span> <span class="s1">&#39;func_annot_categories.tab&#39;</span><span class="p">,</span>
                 <span class="n">fnFuncTidy</span> <span class="o">=</span> <span class="s1">&#39;functional.csv&#39;</span><span class="p">,</span>
                 <span class="n">fnKinactTop</span> <span class="o">=</span> <span class="s1">&#39;kinact_top.tab&#39;</span><span class="p">,</span>
                 <span class="n">fnVennPlot</span> <span class="o">=</span> <span class="s1">&#39;FC_Venn_</span><span class="si">%s</span><span class="s1">_</span><span class="si">%s</span><span class="s1">.pdf&#39;</span><span class="p">,</span>
                 <span class="n">ncbi_tax_id</span> <span class="o">=</span> <span class="mi">10090</span><span class="p">,</span>
                 <span class="n">org_strict</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                 <span class="n">flex_resnum</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This is the main class of the module representing an analysis</span>
<span class="sd">        on a set of phosphorylation sites across multiple samples.</span>
<span class="sd">        It provides various methods and workflows for its analysis.</span>
<span class="sd">        </span>
<span class="sd">        :param str dirBase: The base directory.</span>
<span class="sd">        :param str fnIdMapping: The ID mapping (layout) file of the assay.</span>
<span class="sd">                                This is necessary because PEX100 assay</span>
<span class="sd">                                uses non-standard names by default.</span>
<span class="sd">        :param str fnXlsFullData: The phosphoassay data in xls file.</span>
<span class="sd">        :param int ncbi_tax_id: The NCBI Taxonomy ID of the species to</span>
<span class="sd">                                work with. Not necessary to provide your</span>
<span class="sd">                                experimental organism here, it is safe to</span>
<span class="sd">                                let it be human even if the data is from mice.</span>
<span class="sd">    </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">dirBase</span> <span class="o">=</span> <span class="n">dirBase</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">set_path</span><span class="p">(</span><span class="n">fnXlsFullData</span><span class="p">,</span> <span class="s1">&#39;fnXlsFullData&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_path</span><span class="p">(</span><span class="n">fnIdMapping</span><span class="p">,</span> <span class="s1">&#39;fnIdMapping&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_path</span><span class="p">(</span><span class="n">fnCombined</span><span class="p">,</span> <span class="s1">&#39;fnCombined&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_path</span><span class="p">(</span><span class="n">fnFcTable</span><span class="p">,</span> <span class="s1">&#39;fnFcTable&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_path</span><span class="p">(</span><span class="n">fnFcUTable</span><span class="p">,</span> <span class="s1">&#39;fnFcUTable&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_path</span><span class="p">(</span><span class="n">fnFcSUTable</span><span class="p">,</span> <span class="s1">&#39;fnFcSUTable&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_path</span><span class="p">(</span><span class="n">fnFcTopTable</span><span class="p">,</span> <span class="s1">&#39;fnFcTopTable&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_path</span><span class="p">(</span><span class="n">fnFcTopCommon</span><span class="p">,</span> <span class="s1">&#39;fnFcTopCommon&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_path</span><span class="p">(</span><span class="n">fnFuncCat</span><span class="p">,</span> <span class="s1">&#39;fnFuncCat&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_path</span><span class="p">(</span><span class="n">fnFuncTidy</span><span class="p">,</span> <span class="s1">&#39;fnFuncTidy&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_path</span><span class="p">(</span><span class="n">fnKinactTop</span><span class="p">,</span> <span class="s1">&#39;fnKinactTop&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_path</span><span class="p">(</span><span class="n">fnVennPlot</span><span class="p">,</span> <span class="s1">&#39;fnVennPlot&#39;</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">reAnnot</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;([\-\s/\.,\(\)\+A-Za-z0-9]{2,}) &#39;</span>\
            <span class="sa">r</span><span class="s1">&#39;\(([A-Z][a-z]+)-?([A-Za-z0-9/]*)\)&#39;</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">reRes</span>  <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;([A-Z]?[a-z]*)([0-9]+)&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reORes</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[A-Za-z]{0,3}([/0-9]+)+&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rePsite</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;([A-Z0-9]+)_([A-Z])([0-9]+)&#39;</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">dAaletters</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;Thr&#39;</span><span class="p">:</span> <span class="s1">&#39;T&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Tyr&#39;</span><span class="p">:</span> <span class="s1">&#39;Y&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Ser&#39;</span><span class="p">:</span> <span class="s1">&#39;S&#39;</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dOrg</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;H&#39;</span><span class="p">:</span> <span class="mi">9606</span><span class="p">,</span>
            <span class="s1">&#39;M&#39;</span><span class="p">:</span> <span class="mi">10090</span><span class="p">,</span>
            <span class="s1">&#39;R&#39;</span><span class="p">:</span> <span class="mi">10116</span>
        <span class="p">}</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">ncbi_tax_id</span> <span class="o">=</span> <span class="n">ncbi_tax_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">org_strict</span> <span class="o">=</span> <span class="n">org_strict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flex_resnum</span> <span class="o">=</span> <span class="n">flex_resnum</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">standards</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Beta actin&#39;</span><span class="p">,</span> <span class="s1">&#39;GAPDH&#39;</span><span class="p">,</span> <span class="s1">&#39;PKC pan activation site&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dStd</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">lDataCols</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;Control&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;BMP8b&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;NE&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;BMP8b_NE&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)]</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">dMissingHomologs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;IKK-alpha&#39;</span><span class="p">:</span> <span class="s1">&#39;Q60680&#39;</span><span class="p">,</span>
            <span class="s1">&#39;IKK-alpha/beta&#39;</span><span class="p">:</span> <span class="s1">&#39;Q60680&#39;</span><span class="p">,</span>
            <span class="s1">&#39;GAPDH&#39;</span><span class="p">:</span> <span class="s1">&#39;P16858&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Calmodulin&#39;</span><span class="p">:</span> <span class="s1">&#39;P62204&#39;</span><span class="p">,</span>
            <span class="s1">&#39;TYK2&#39;</span><span class="p">:</span> <span class="s1">&#39;Q9R117&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Beta actin&#39;</span><span class="p">:</span> <span class="s1">&#39;P60710&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Met&#39;</span><span class="p">:</span> <span class="s1">&#39;P16056&#39;</span><span class="p">,</span>
            <span class="s1">&#39;ATP1A1/Na+K+ ATPase1&#39;</span><span class="p">:</span> <span class="s1">&#39;Q8VDN2&#39;</span><span class="p">,</span>
            <span class="s1">&#39;GRK1&#39;</span><span class="p">:</span> <span class="s1">&#39;Q9WVL4&#39;</span><span class="p">,</span>
            <span class="s1">&#39;MAP3K7/TAK1&#39;</span><span class="p">:</span> <span class="s1">&#39;Q62073&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Rel&#39;</span><span class="p">:</span> <span class="s1">&#39;P15307&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Gab2&#39;</span><span class="p">:</span> <span class="s1">&#39;Q9Z1S8&#39;</span><span class="p">,</span>
            <span class="s1">&#39;DDX5/DEAD-box protein 5&#39;</span><span class="p">:</span> <span class="s1">&#39;Q61656&#39;</span><span class="p">,</span>
            <span class="s1">&#39;MARCKS&#39;</span><span class="p">:</span> <span class="s1">&#39;P26645&#39;</span><span class="p">,</span>
            <span class="s1">&#39;PLD1&#39;</span><span class="p">:</span> <span class="s1">&#39;Q9Z280&#39;</span><span class="p">,</span>
            <span class="s1">&#39;CD45&#39;</span><span class="p">:</span> <span class="s1">&#39;P06800&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Pim-1&#39;</span><span class="p">:</span> <span class="s1">&#39;P06803&#39;</span><span class="p">,</span>
            <span class="s1">&#39;MAP3K1/MEKK1&#39;</span><span class="p">:</span> <span class="s1">&#39;P53349&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Progesterone Receptor&#39;</span><span class="p">:</span> <span class="s1">&#39;Q00175&#39;</span><span class="p">,</span>
            <span class="s1">&#39;PAK1&#39;</span><span class="p">:</span> <span class="s1">&#39;O88643&#39;</span><span class="p">,</span>
            <span class="s1">&#39;RapGEF1&#39;</span><span class="p">:</span> <span class="s1">&#39;Q8C5V7&#39;</span><span class="p">,</span>
            <span class="s1">&#39;PAK1/2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;O88643&#39;</span><span class="p">,</span> <span class="s1">&#39;Q8CIN4&#39;</span><span class="p">],</span>
            <span class="s1">&#39;PAK1/2/3&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;O88643&#39;</span><span class="p">,</span> <span class="s1">&#39;Q8CIN4&#39;</span><span class="p">,</span> <span class="s1">&#39;Q61036&#39;</span><span class="p">],</span>
            <span class="s1">&#39;CD227/mucin 1&#39;</span><span class="p">:</span> <span class="s1">&#39;Q02496&#39;</span><span class="p">,</span>
            <span class="s1">&#39;HDAC3&#39;</span><span class="p">:</span> <span class="s1">&#39;O88895&#39;</span><span class="p">,</span>
            <span class="s1">&#39;TSC2&#39;</span><span class="p">:</span> <span class="s1">&#39;Q61037&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Tuberin/TSC2&#39;</span><span class="p">:</span> <span class="s1">&#39;Q61037&#39;</span><span class="p">,</span>
            <span class="s1">&#39;CaMK4&#39;</span><span class="p">:</span> <span class="s1">&#39;P08414&#39;</span><span class="p">,</span>
            <span class="s1">&#39;STAT2&#39;</span><span class="p">:</span> <span class="s1">&#39;Q9WVL2&#39;</span><span class="p">,</span>
            <span class="s1">&#39;AurB/C&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;O70126&#39;</span><span class="p">,</span> <span class="s1">&#39;O88445&#39;</span><span class="p">],</span>
            <span class="s1">&#39;JAK1&#39;</span><span class="p">:</span> <span class="s1">&#39;P52332&#39;</span><span class="p">,</span>
            <span class="s1">&#39;NFAT4&#39;</span><span class="p">:</span> <span class="s1">&#39;P97305&#39;</span><span class="p">,</span>
            <span class="s1">&#39;HDAC5&#39;</span><span class="p">:</span> <span class="s1">&#39;Q9Z2V6&#39;</span><span class="p">,</span>
            <span class="s1">&#39;VEGFR2&#39;</span><span class="p">:</span> <span class="s1">&#39;P35918&#39;</span><span class="p">,</span>
            <span class="s1">&#39;STAT1&#39;</span><span class="p">:</span> <span class="s1">&#39;P42225&#39;</span><span class="p">,</span>
            <span class="s1">&#39;EPHA2/3/4&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Q03145&#39;</span><span class="p">,</span> <span class="s1">&#39;Q03137&#39;</span><span class="p">,</span> <span class="s1">&#39;P29319&#39;</span><span class="p">],</span>
            <span class="s1">&#39;Histone H3.1&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;P68433&#39;</span><span class="p">,</span> <span class="s1">&#39;P84228&#39;</span><span class="p">,</span> <span class="s1">&#39;P84244&#39;</span><span class="p">]</span>
        <span class="p">}</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">dAssayRefCorrection</span> <span class="o">=</span> <span class="p">{</span>
            <span class="p">(</span><span class="s1">&#39;Kv1.3/KCNA3&#39;</span><span class="p">,</span> <span class="mi">135</span><span class="p">):</span> <span class="p">{</span>
                <span class="mi">9606</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="mi">187</span><span class="p">),</span>
                <span class="mi">10090</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="mi">140</span><span class="p">),</span>
                <span class="mi">10116</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="mi">137</span><span class="p">)</span>
            <span class="p">},</span>
            <span class="p">(</span><span class="s1">&#39;PKC delta&#39;</span><span class="p">,</span> <span class="mi">505</span><span class="p">):</span> <span class="p">{</span>
                <span class="mi">9606</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="mi">507</span><span class="p">)</span>
            <span class="p">},</span>
            <span class="p">(</span><span class="s1">&#39;Opioid Receptor&#39;</span><span class="p">,</span> <span class="mi">375</span><span class="p">):</span> <span class="p">{</span>
                <span class="mi">9606</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="mi">377</span><span class="p">)</span>
            <span class="p">},</span>
            <span class="p">(</span><span class="s1">&#39;IkB-epsilon&#39;</span><span class="p">,</span> <span class="mi">22</span><span class="p">):</span> <span class="p">{</span>
                <span class="mi">9606</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="mi">161</span><span class="p">)</span>
            <span class="p">},</span>
            <span class="p">(</span><span class="s1">&#39;HSL&#39;</span><span class="p">,</span> <span class="mi">563</span><span class="p">):</span> <span class="p">{</span>
                <span class="mi">9606</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="mi">853</span><span class="p">),</span>
                <span class="mi">10090</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="mi">557</span><span class="p">),</span>
                <span class="mi">10116</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="mi">863</span><span class="p">)</span>
            <span class="p">},</span>
            <span class="p">(</span><span class="s1">&#39;KSR&#39;</span><span class="p">,</span> <span class="mi">392</span><span class="p">):</span> <span class="p">{</span>
                <span class="mi">9606</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="mi">406</span><span class="p">),</span>
                <span class="mi">10116</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="mi">40</span><span class="p">)</span>
            <span class="p">},</span>
            <span class="p">(</span><span class="s1">&#39;BAD&#39;</span><span class="p">,</span> <span class="mi">155</span><span class="p">):</span> <span class="p">{</span>
                <span class="mi">9606</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="mi">118</span><span class="p">),</span>
                <span class="mi">10116</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="mi">156</span><span class="p">)</span>
            <span class="p">},</span>
            <span class="p">(</span><span class="s1">&#39;BAD&#39;</span><span class="p">,</span> <span class="mi">112</span><span class="p">):</span> <span class="p">{</span>
                <span class="mi">9606</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="mi">75</span><span class="p">),</span>
                <span class="mi">10116</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="mi">113</span><span class="p">)</span>
            <span class="p">},</span>
            <span class="c1"># this EPHB2</span>
            <span class="p">(</span><span class="s1">&#39;EPHB1/2&#39;</span><span class="p">,</span> <span class="mi">604</span><span class="p">):</span> <span class="p">{</span>
                <span class="mi">9606</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="mi">596</span><span class="p">),</span>
                <span class="mi">10090</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="mi">596</span><span class="p">),</span>
                <span class="mi">10116</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="mi">709</span><span class="p">)</span>
            <span class="p">},</span>
            <span class="p">(</span><span class="s1">&#39;NMDAR2B&#39;</span><span class="p">,</span> <span class="mi">1472</span><span class="p">):</span> <span class="p">{</span>
                <span class="mi">9606</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="mi">1474</span><span class="p">)</span>
            <span class="p">},</span>
            <span class="p">(</span><span class="s1">&#39;SRF&#39;</span><span class="p">,</span> <span class="mi">99</span><span class="p">):</span> <span class="p">{</span>
                <span class="mi">9606</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="mi">103</span><span class="p">)</span>
            <span class="p">},</span>
            <span class="p">(</span><span class="s1">&#39;JAK1&#39;</span><span class="p">,</span> <span class="mi">1022</span><span class="p">):</span> <span class="p">{</span>
                <span class="mi">9606</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="mi">1034</span><span class="p">),</span>
                <span class="mi">10090</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="mi">1033</span><span class="p">)</span>
            <span class="p">},</span>
            <span class="p">(</span><span class="s1">&#39;IkB-beta&#39;</span><span class="p">,</span> <span class="mi">19</span><span class="p">):</span> <span class="p">{</span>
                <span class="mi">9606</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="mi">19</span><span class="p">)</span>
            <span class="p">},</span>
            <span class="p">(</span><span class="s1">&#39;Myosin regulatory light chain 2&#39;</span><span class="p">,</span> <span class="mi">18</span><span class="p">):</span> <span class="p">{</span>
                <span class="mi">9606</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span>
                <span class="mi">10090</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span>
                <span class="mi">10116</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
            <span class="p">},</span>
            <span class="p">(</span><span class="s1">&#39;BAD&#39;</span><span class="p">,</span> <span class="mi">128</span><span class="p">):</span> <span class="p">{</span>
                <span class="mi">9606</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="mi">91</span><span class="p">),</span>
                <span class="mi">10116</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="mi">129</span><span class="p">)</span>
            <span class="p">},</span>
            <span class="p">(</span><span class="s1">&#39;BAD&#39;</span><span class="p">,</span> <span class="mi">136</span><span class="p">):</span> <span class="p">{</span>
                <span class="mi">9606</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="mi">99</span><span class="p">),</span>
                <span class="mi">10116</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="mi">137</span><span class="p">)</span>
            <span class="p">},</span>
            <span class="p">(</span><span class="s1">&#39;RelB&#39;</span><span class="p">,</span> <span class="mi">552</span><span class="p">):</span> <span class="p">{</span>
                <span class="mi">9606</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="mi">573</span><span class="p">)</span>
            <span class="p">},</span>
            <span class="p">(</span><span class="s1">&#39;IL3RB&#39;</span><span class="p">,</span> <span class="mi">593</span><span class="p">):</span> <span class="p">{</span>
                <span class="mi">10090</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="mi">595</span><span class="p">)</span>
            <span class="p">},</span>
            <span class="p">(</span><span class="s1">&#39;BIM&#39;</span><span class="p">,</span> <span class="mi">65</span><span class="p">):</span> <span class="p">{</span>
                <span class="mi">9606</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="mi">69</span><span class="p">)</span>
            <span class="p">},</span>
            <span class="p">(</span><span class="s1">&#39;CaMK4&#39;</span><span class="p">,</span> <span class="mi">196</span><span class="p">):</span> <span class="p">{</span>
                <span class="mi">9606</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
    
    <span class="k">def</span> <span class="nf">reload</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">modname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__module__</span>
        <span class="n">mod</span> <span class="o">=</span> <span class="nb">__import__</span><span class="p">(</span><span class="n">modname</span><span class="p">,</span> <span class="n">fromlist</span> <span class="o">=</span> <span class="p">[</span><span class="n">modname</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="n">imp</span><span class="o">.</span><span class="n">reload</span><span class="p">(</span><span class="n">mod</span><span class="p">)</span>
        <span class="n">new</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;__class__&#39;</span><span class="p">,</span> <span class="n">new</span><span class="p">)</span>
    
    <span class="c1">#</span>
    <span class="c1"># Loading experimental data.</span>
    <span class="c1">#</span>
    
<div class="viewcode-block" id="Pex100.main"><a class="viewcode-back" href="../../index.html#pex100.Pex100.main">[docs]</a>    <span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">network</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads and preprocesses all input data.</span>
<span class="sd">        Runs the whole data processing and analysis and exports files.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">init_pypath</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">idmapping</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_tables</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_ptms</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_seq</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_ptms</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ptms_lookup</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">network</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">network</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">combined_table</span><span class="p">(</span><span class="n">to_file</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fc_table</span><span class="p">(</span><span class="n">to_file</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">regulatory_sites</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fc_table</span><span class="p">(</span><span class="n">to_file</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_go</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fc_top_table</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kinact_analysis</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kinact_top</span><span class="p">(</span><span class="n">threshold</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">fname</span> <span class="o">=</span> <span class="s1">&#39;kinact_top.tab&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">functional_array</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tidy_functional_array</span><span class="p">()</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">:: Tests without effect sign:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">functional_compare_fcs</span><span class="p">()</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">:: Tests with effect sign:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">functional_compare_fcs</span><span class="p">(</span><span class="n">signs</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="Pex100.network"><a class="viewcode-back" href="../../index.html#pex100.Pex100.network">[docs]</a>    <span class="k">def</span> <span class="nf">network</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extra_proteins</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">edges_percentile</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> <span class="n">pfile</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads and processes the network.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collect_proteins</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_network</span><span class="p">(</span><span class="n">pfile</span> <span class="o">=</span> <span class="n">pfile</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_network</span><span class="p">(</span><span class="n">keep_also</span> <span class="o">=</span> <span class="n">extra_proteins</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sparsen_network</span><span class="p">(</span><span class="n">perc</span> <span class="o">=</span> <span class="n">edges_percentile</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="Pex100.set_path"><a class="viewcode-back" href="../../index.html#pex100.Pex100.set_path">[docs]</a>    <span class="k">def</span> <span class="nf">set_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the path to a file in basedir.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dirBase</span><span class="p">,</span> <span class="n">fname</span><span class="p">))</span></div>
    
<div class="viewcode-block" id="Pex100.init_pypath"><a class="viewcode-back" href="../../index.html#pex100.Pex100.init_pypath">[docs]</a>    <span class="k">def</span> <span class="nf">init_pypath</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes a PyPath object for mapping and network building.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pa</span> <span class="o">=</span> <span class="n">pypath</span><span class="o">.</span><span class="n">PyPath</span><span class="p">(</span><span class="n">ncbi_tax_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ncbi_tax_id</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="Pex100.read_tables"><a class="viewcode-back" href="../../index.html#pex100.Pex100.read_tables">[docs]</a>    <span class="k">def</span> <span class="nf">read_tables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads all data tables.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_signals</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_coeffvar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_normalized</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_psites_diffs</span><span class="p">()</span></div>
    
<div class="viewcode-block" id="Pex100.idmapping"><a class="viewcode-back" href="../../index.html#pex100.Pex100.idmapping">[docs]</a>    <span class="k">def</span> <span class="nf">idmapping</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Builds the idmapping table in order to translate the custom names</span>
<span class="sd">        to UniProts already at loading the table.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_idmapping</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_organism_specificities</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ncbi_tax_id</span> <span class="o">==</span> <span class="mi">10090</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mousedict</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">idmapping2mouse</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dNamesUniprots</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dNamesMouseUniprots</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dNamesHumanUniprots</span> <span class="o">=</span> \
                <span class="nb">dict</span><span class="p">(</span>
                    <span class="nb">map</span><span class="p">(</span>
                        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span>
                            <span class="p">(</span>
                                <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                            <span class="p">),</span>
                        <span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dNamesIds</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">dNamesUniprots</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dNamesHumanUniprots</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">dOrgSpecUniprot</span> <span class="o">=</span> \
            <span class="nb">dict</span><span class="p">(</span>
                <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span>
                    <span class="o">*</span><span class="nb">map</span><span class="p">(</span>
                        <span class="k">lambda</span> <span class="n">i</span><span class="p">:</span>
                            <span class="nb">map</span><span class="p">(</span>
                                <span class="k">lambda</span> <span class="n">u</span><span class="p">:</span>
                                    <span class="p">(</span>
                                        <span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]),</span>
                                        <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                                    <span class="p">),</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">dNamesUniprots</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
                            <span class="p">),</span>
                        <span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dOrgSpec</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span></div>
    
<div class="viewcode-block" id="Pex100.read_psites_diffs"><a class="viewcode-back" href="../../index.html#pex100.Pex100.read_psites_diffs">[docs]</a>    <span class="k">def</span> <span class="nf">read_psites_diffs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads the measured values for each phosphosite at each condition.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">read_data</span><span class="p">(</span><span class="s1">&#39;Psite&#39;</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">582</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="Pex100.read_signals"><a class="viewcode-back" href="../../index.html#pex100.Pex100.read_signals">[docs]</a>    <span class="k">def</span> <span class="nf">read_signals</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads the mean of duplicates signal values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">read_data</span><span class="p">(</span><span class="s1">&#39;Signal&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1320</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="Pex100.read_coeffvar"><a class="viewcode-back" href="../../index.html#pex100.Pex100.read_coeffvar">[docs]</a>    <span class="k">def</span> <span class="nf">read_coeffvar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads coefficient of variation values for each pair of spots.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">read_data</span><span class="p">(</span><span class="s1">&#39;CVar&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">1320</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="Pex100.read_normalized"><a class="viewcode-back" href="../../index.html#pex100.Pex100.read_normalized">[docs]</a>    <span class="k">def</span> <span class="nf">read_normalized</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads the values normalized to median.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">read_data</span><span class="p">(</span><span class="s1">&#39;Norm&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">1320</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="Pex100.read_data"><a class="viewcode-back" href="../../index.html#pex100.Pex100.read_data">[docs]</a>    <span class="k">def</span> <span class="nf">read_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">ncol</span><span class="p">,</span> <span class="n">nrow</span><span class="p">,</span> <span class="n">vcol</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads a data table with its annotations.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;llFullData&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">llFullData</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_raw</span><span class="p">()</span>
        
        <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span>
        
        <span class="n">attr</span> <span class="o">=</span> <span class="s1">&#39;ll</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">name</span>
        
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ll_table_slice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">llFullData</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">ncol</span><span class="p">,</span> <span class="n">nrow</span><span class="p">))</span>
        
        <span class="n">annot</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_arrays</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">),</span> <span class="n">vcol</span><span class="p">)</span>
        
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;a</span><span class="si">%s</span><span class="s1">Annot&#39;</span> <span class="o">%</span> <span class="n">name</span><span class="p">,</span> <span class="n">annot</span><span class="p">)</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;a</span><span class="si">%s</span><span class="s1">Data&#39;</span> <span class="o">%</span> <span class="n">name</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">dStd</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_standards</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">vcol</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="Pex100.get_standards"><a class="viewcode-back" href="../../index.html#pex100.Pex100.get_standards">[docs]</a>    <span class="k">def</span> <span class="nf">get_standards</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">vcol</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the values from the standards.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> \
            <span class="nb">dict</span><span class="p">(</span>
                <span class="nb">map</span><span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">l</span><span class="p">:</span>
                        <span class="p">(</span>
                            <span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                            <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">l</span><span class="p">[</span><span class="n">vcol</span><span class="p">:]))</span>
                        <span class="p">),</span>
                    <span class="nb">filter</span><span class="p">(</span>
                        <span class="k">lambda</span> <span class="n">l</span><span class="p">:</span>
                            <span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">standards</span><span class="p">,</span>
                        <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;ll</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span></div>
    
<div class="viewcode-block" id="Pex100.read_raw"><a class="viewcode-back" href="../../index.html#pex100.Pex100.read_raw">[docs]</a>    <span class="k">def</span> <span class="nf">read_raw</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads the full xls table.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">llFullData</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_xls</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fnXlsFullData</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="Pex100.read_xls"><a class="viewcode-back" href="../../index.html#pex100.Pex100.read_xls">[docs]</a>    <span class="k">def</span> <span class="nf">read_xls</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xls_file</span><span class="p">,</span> <span class="n">sheet</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">csv_file</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">return_table</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generic function to read MS Excel XLS file. Converts one sheet</span>
<span class="sd">        to CSV, or returns as a list of lists</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">table</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">book</span> <span class="o">=</span> <span class="n">xlrd</span><span class="o">.</span><span class="n">open_workbook</span><span class="p">(</span><span class="n">xls_file</span><span class="p">,</span> <span class="n">on_demand</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">sheet</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
                    <span class="n">sheet</span> <span class="o">=</span> <span class="n">book</span><span class="o">.</span><span class="n">sheet_by_index</span><span class="p">(</span><span class="n">sheet</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">sheet</span> <span class="o">=</span> <span class="n">book</span><span class="o">.</span><span class="n">sheet_by_name</span><span class="p">(</span><span class="n">sheet</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">xlrd</span><span class="o">.</span><span class="n">biffh</span><span class="o">.</span><span class="n">XLRDError</span><span class="p">:</span>
                <span class="n">sheet</span> <span class="o">=</span> <span class="n">book</span><span class="o">.</span><span class="n">sheet_by_index</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">table</span> <span class="o">=</span> <span class="p">[[</span><span class="n">unicode</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> \
                <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">sheet</span><span class="o">.</span><span class="n">row</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span> \
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="n">sheet</span><span class="o">.</span><span class="n">nrows</span><span class="p">)]</span>
        <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;No such file: </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">xls_file</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">book</span> <span class="o">=</span> <span class="n">openpyxl</span><span class="o">.</span><span class="n">load_workbook</span><span class="p">(</span><span class="n">filename</span> <span class="o">=</span> <span class="n">xls_file</span><span class="p">,</span>
                    <span class="n">read_only</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">Could not open xls: </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">xls_file</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">xls_file</span><span class="p">):</span>
                    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">File does not exist.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">sheet</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
                    <span class="n">sheet</span> <span class="o">=</span> <span class="n">book</span><span class="o">.</span><span class="n">worksheets</span><span class="p">[</span><span class="n">sheet</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">sheet</span> <span class="o">=</span> <span class="n">book</span><span class="p">[</span><span class="n">sheet</span><span class="p">]</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">sheet</span> <span class="o">=</span> <span class="n">book</span><span class="o">.</span><span class="n">worksheets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">cells</span> <span class="o">=</span> <span class="n">sheet</span><span class="o">.</span><span class="n">get_squared_range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
                <span class="n">sheet</span><span class="o">.</span><span class="n">max_column</span><span class="p">,</span> <span class="n">sheet</span><span class="o">.</span><span class="n">max_row</span><span class="p">)</span>
            <span class="n">table</span> <span class="o">=</span> \
                <span class="nb">list</span><span class="p">(</span>
                    <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span>
                        <span class="nb">list</span><span class="p">(</span>
                            <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">c</span><span class="p">:</span>
                                <span class="n">unicode</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">value</span><span class="p">),</span>
                                <span class="n">row</span>
                            <span class="p">)</span>
                        <span class="p">),</span>
                        <span class="n">cells</span>
                    <span class="p">)</span>
                <span class="p">)</span>
        <span class="k">if</span> <span class="n">csv_file</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">csv_file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csv</span><span class="p">:</span>
                <span class="n">csv</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">table</span><span class="p">]))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">return_table</span><span class="p">:</span>
            <span class="n">table</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="s1">&#39;book&#39;</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">()</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">book</span><span class="p">,</span> <span class="s1">&#39;release_resources&#39;</span><span class="p">):</span>
            <span class="n">book</span><span class="o">.</span><span class="n">release_resources</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">table</span></div>
    
<div class="viewcode-block" id="Pex100.ll_table_slice"><a class="viewcode-back" href="../../index.html#pex100.Pex100.ll_table_slice">[docs]</a>    <span class="k">def</span> <span class="nf">ll_table_slice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">ncol</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">nrow</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a slice from a list-of-lists table, starting at (row, col),</span>
<span class="sd">        height and width of (nrow, ncol).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cend</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">ncol</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">col</span> <span class="o">+</span> <span class="n">ncol</span>
        <span class="n">rend</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">nrow</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">row</span> <span class="o">+</span> <span class="n">nrow</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">l</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">l</span><span class="p">)[</span><span class="n">col</span><span class="p">:</span><span class="n">cend</span><span class="p">],</span> <span class="n">table</span><span class="p">[</span><span class="n">row</span><span class="p">:</span><span class="n">rend</span><span class="p">]))</span></div>
    
<div class="viewcode-block" id="Pex100.get_arrays"><a class="viewcode-back" href="../../index.html#pex100.Pex100.get_arrays">[docs]</a>    <span class="k">def</span> <span class="nf">get_arrays</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">llTable</span><span class="p">,</span> <span class="n">vcol</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns annotations and data as numpy arrays.</span>
<span class="sd">        Requires list-of-lists table and</span>
<span class="sd">        the column number where data values start.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">return</span> \
            <span class="nb">list</span><span class="p">(</span>
                <span class="nb">map</span><span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">a</span><span class="p">:</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                    <span class="c1"># zip data and dtype</span>
                    <span class="nb">zip</span><span class="p">(</span>
                        <span class="c1"># zip annotations and values</span>
                        <span class="nb">zip</span><span class="p">(</span>
                            <span class="o">*</span><span class="nb">list</span><span class="p">(</span>
                                <span class="c1"># filter organism mismatches</span>
                                <span class="nb">filter</span><span class="p">(</span>
                                    <span class="k">lambda</span> <span class="n">r</span><span class="p">:</span>
                                        <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">org_strict</span> <span class="ow">or</span> \
                                            <span class="bp">self</span><span class="o">.</span><span class="n">ncbi_tax_id</span> <span class="ow">in</span> \
                                            <span class="bp">self</span><span class="o">.</span><span class="n">dOrgSpec</span><span class="p">[(</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">4</span><span class="p">])],</span>
                                    <span class="c1"># chain rows &amp; residues</span>
                                    <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span>
                                        <span class="o">*</span><span class="nb">map</span><span class="p">(</span>
                                            <span class="c1"># iterate rows</span>
                                            <span class="c1"># here one row is one antibody</span>
                                            <span class="c1"># with enumerate we get an</span>
                                            <span class="c1"># unique ID for each antibody</span>
                                            <span class="k">lambda</span> <span class="n">ill</span><span class="p">:</span>
                                                <span class="nb">list</span><span class="p">(</span>
                                                    <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span>
                                                        <span class="o">*</span><span class="nb">map</span><span class="p">(</span>
                                                            <span class="c1"># iterate residues</span>
                                                            <span class="k">lambda</span> <span class="n">res</span><span class="p">:</span>
                                                                <span class="nb">map</span><span class="p">(</span>
                                                                    <span class="k">lambda</span> <span class="n">u</span><span class="p">:</span>
                                                                        <span class="p">(</span>
                                                                            <span class="c1"># annotation</span>
                                                                            <span class="p">[</span>
                                                                                <span class="n">u</span><span class="p">,</span>
                                                                                <span class="n">ill</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                                                                                <span class="n">ill</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                                                                                <span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                                                <span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                                                                <span class="n">ill</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="c1"># the antibody ID</span>
                                                                                <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reORes</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">ill</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]))</span>
                                                                                <span class="c1"># the original residue numbers:</span>
                                                                                <span class="c1"># sometimes these are needed for</span>
                                                                                <span class="c1"># an unambiguous identification</span>
                                                                                <span class="c1"># of the antibodies</span>
                                                                            <span class="p">],</span>
                                                                            <span class="c1"># values</span>
                                                                            <span class="n">ill</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                                                                        <span class="p">),</span>
                                                                    <span class="c1"># one name might be mapped to</span>
                                                                    <span class="c1"># multiple UniProt IDs</span>
                                                                    <span class="bp">self</span><span class="o">.</span><span class="n">dNamesUniprots</span><span class="p">[</span><span class="n">ill</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
                                                                <span class="p">),</span>
                                                            <span class="c1"># one antibody might detect multiple</span>
                                                            <span class="c1"># phosphorylations</span>
                                                            <span class="bp">self</span><span class="o">.</span><span class="n">get_residues</span><span class="p">(</span><span class="n">ill</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
                                                        <span class="p">)</span>
                                                    <span class="p">)</span>
                                                <span class="p">),</span>
                                            <span class="nb">enumerate</span><span class="p">(</span>
                                                <span class="nb">map</span><span class="p">(</span>
                                                    <span class="c1"># for each row, match annotation</span>
                                                    <span class="c1"># and convert data to float</span>
                                                    <span class="k">lambda</span> <span class="n">l</span><span class="p">:</span>
                                                        <span class="p">(</span>
                                                            <span class="bp">self</span><span class="o">.</span><span class="n">reAnnot</span><span class="o">.</span>\
                                                                <span class="n">match</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">groups</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
                                                            <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">l</span><span class="p">[</span><span class="n">vcol</span><span class="p">:]))</span>
                                                        <span class="p">),</span>
                                                    <span class="c1"># starting from list of lists</span>
                                                    <span class="nb">filter</span><span class="p">(</span>
                                                        <span class="c1"># filter standards</span>
                                                        <span class="k">lambda</span> <span class="n">l</span><span class="p">:</span>
                                                            <span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">standards</span><span class="p">,</span>
                                                        <span class="n">llTable</span>
                                                    <span class="p">)</span>
                                                <span class="p">)</span>
                                            <span class="p">)</span>
                                        <span class="p">)</span>
                                    <span class="p">)</span>
                                <span class="p">)</span>
                            <span class="p">)</span>
                        <span class="p">),</span>
                        <span class="c1"># dtypes for annot. and data</span>
                        <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">object</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">]</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span></div>
    
<div class="viewcode-block" id="Pex100.get_residues"><a class="viewcode-back" href="../../index.html#pex100.Pex100.get_residues">[docs]</a>    <span class="k">def</span> <span class="nf">get_residues</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">res</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Matches residues in string,</span>
<span class="sd">        returns tuples of tuples with residue names and numbers.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ress</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reRes</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
        <span class="n">aa</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">sres</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">ress</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dAaletters</span><span class="p">:</span>
                <span class="n">aa</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dAaletters</span><span class="p">[</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="n">sres</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">aa</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">sres</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="Pex100.read_organism_specificities"><a class="viewcode-back" href="../../index.html#pex100.Pex100.read_organism_specificities">[docs]</a>    <span class="k">def</span> <span class="nf">read_organism_specificities</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads the organism specificities of the assay probes.</span>
<span class="sd">        These are either for human, mouse, rat, or any combination of these.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fnIdMapping</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dOrgSpec</span> <span class="o">=</span> \
                <span class="nb">dict</span><span class="p">(</span>
                    <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span>
                        <span class="o">*</span><span class="nb">map</span><span class="p">(</span>
                            <span class="k">lambda</span> <span class="n">p</span><span class="p">:</span>
                                <span class="nb">map</span><span class="p">(</span>
                                    <span class="k">lambda</span> <span class="n">res</span><span class="p">:</span>
                                        <span class="p">(</span>
                                            <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                                            <span class="nb">list</span><span class="p">(</span>
                                                <span class="nb">map</span><span class="p">(</span>
                                                    <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span>
                                                        <span class="bp">self</span><span class="o">.</span><span class="n">dOrg</span><span class="p">[</span><span class="n">s</span><span class="p">],</span>
                                                    <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                                                <span class="p">)</span>
                                            <span class="p">)</span>
                                        <span class="p">),</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">get_residues</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
                                <span class="p">),</span>
                            <span class="nb">map</span><span class="p">(</span>
                                <span class="k">lambda</span> <span class="n">l</span><span class="p">:</span>
                                    <span class="p">(</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">reAnnot</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">groups</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
                                        <span class="n">l</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                                    <span class="p">),</span>
                                <span class="nb">filter</span><span class="p">(</span>
                                    <span class="k">lambda</span> <span class="n">l</span><span class="p">:</span>
                                        <span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">standards</span><span class="p">,</span>
                                    <span class="nb">map</span><span class="p">(</span>
                                        <span class="k">lambda</span> <span class="n">l</span><span class="p">:</span>
                                            <span class="n">l</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">),</span>
                                        <span class="n">f</span>
                                    <span class="p">)</span>
                                <span class="p">)</span>
                            <span class="p">)</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                <span class="p">)</span></div>
    
<div class="viewcode-block" id="Pex100.read_idmapping"><a class="viewcode-back" href="../../index.html#pex100.Pex100.read_idmapping">[docs]</a>    <span class="k">def</span> <span class="nf">read_idmapping</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads the mapping between the assay custom names and</span>
<span class="sd">        standard IDs (UniProt and Entrez Gene).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fnIdMapping</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dNamesIds</span> <span class="o">=</span> \
                <span class="nb">dict</span><span class="p">(</span>
                    <span class="nb">map</span><span class="p">(</span>
                        <span class="k">lambda</span> <span class="n">l</span><span class="p">:</span>
                            <span class="p">(</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">reAnnot</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">groups</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> \
                                    <span class="k">if</span> <span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">standards</span> \
                                    <span class="k">else</span> <span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="c1"># name</span>
                                <span class="p">(</span>
                                    <span class="nb">list</span><span class="p">(</span>
                                        <span class="nb">map</span><span class="p">(</span>
                                            <span class="k">lambda</span> <span class="n">u</span><span class="p">:</span>
                                                <span class="n">u</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span>
                                            <span class="n">l</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">),</span> <span class="c1"># uniprot</span>
                                        <span class="p">)</span>
                                    <span class="p">),</span>
                                    <span class="nb">list</span><span class="p">(</span>
                                        <span class="nb">map</span><span class="p">(</span>
                                            <span class="k">lambda</span> <span class="n">e</span><span class="p">:</span>
                                                <span class="n">e</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span>
                                            <span class="n">l</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                                                <span class="s1">&#39;</span><span class="se">\xa0</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span><span class="c1"># entrez</span>
                                        <span class="p">)</span>
                                    <span class="p">)</span>
                                <span class="p">)</span>
                            <span class="p">),</span>
                        <span class="nb">map</span><span class="p">(</span>
                            <span class="k">lambda</span> <span class="n">l</span><span class="p">:</span>
                                <span class="n">l</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">),</span>
                            <span class="n">f</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                <span class="p">)</span></div>
    
<div class="viewcode-block" id="Pex100.idmapping2mouse"><a class="viewcode-back" href="../../index.html#pex100.Pex100.idmapping2mouse">[docs]</a>    <span class="k">def</span> <span class="nf">idmapping2mouse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a dict of names to mouse UniProt IDs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dNamesMouseUniprots</span> <span class="o">=</span> \
            <span class="nb">dict</span><span class="p">(</span>
                <span class="nb">map</span><span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">i</span><span class="p">:</span>
                        <span class="p">(</span>
                            <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                            <span class="nb">list</span><span class="p">(</span>
                                <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span>
                                    <span class="o">*</span><span class="nb">map</span><span class="p">(</span>
                                        <span class="k">lambda</span> <span class="n">e</span><span class="p">:</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">pa</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">e</span><span class="p">,</span>
                                                                    <span class="s1">&#39;entrez&#39;</span><span class="p">,</span>
                                                                    <span class="s1">&#39;uniprot&#39;</span><span class="p">,</span>
                                                                    <span class="mi">10090</span><span class="p">),</span>
                                        <span class="n">reduce</span><span class="p">(</span>
                                            <span class="k">lambda</span> <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">:</span>
                                                <span class="n">s1</span> <span class="o">|</span> <span class="n">s2</span><span class="p">,</span>
                                            <span class="nb">map</span><span class="p">(</span>
                                                <span class="k">lambda</span> <span class="n">h</span><span class="p">:</span>
                                                    <span class="bp">self</span><span class="o">.</span><span class="n">dHuman2Mouse</span><span class="p">[</span><span class="n">h</span><span class="p">],</span>
                                                <span class="nb">filter</span><span class="p">(</span>
                                                    <span class="k">lambda</span> <span class="n">h</span><span class="p">:</span>
                                                        <span class="n">h</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dHuman2Mouse</span><span class="p">,</span>
                                                    <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                                                <span class="p">)</span>
                                            <span class="p">),</span>
                                            <span class="nb">set</span><span class="p">([])</span>
                                        <span class="p">)</span>
                                    <span class="p">)</span>
                                <span class="p">)</span>
                            <span class="p">)</span>
                        <span class="p">),</span>
                    <span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dNamesIds</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>
        
        <span class="c1"># adding missing homologs</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dNamesMouseUniprots</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dMissingHomologs</span><span class="p">:</span>
                <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dMissingHomologs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dNamesMouseUniprots</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dNamesMouseUniprots</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dNamesMouseUniprots</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> \
                    <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dNamesMouseUniprots</span><span class="p">[</span><span class="n">n</span><span class="p">]))</span></div>
    
<div class="viewcode-block" id="Pex100.mousedict"><a class="viewcode-back" href="../../index.html#pex100.Pex100.mousedict">[docs]</a>    <span class="k">def</span> <span class="nf">mousedict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads human to mouse mapping from HomoloGene.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dHuman2Mouse</span> <span class="o">=</span> <span class="n">pypath</span><span class="o">.</span><span class="n">dataio</span><span class="o">.</span><span class="n">homologene_dict</span><span class="p">(</span><span class="mi">9606</span><span class="p">,</span> <span class="mi">10090</span><span class="p">,</span> <span class="s1">&#39;entrez&#39;</span><span class="p">)</span></div>
    
    <span class="c1">#</span>
    <span class="c1"># Loading database data.</span>
    <span class="c1">#</span>
    
<div class="viewcode-block" id="Pex100.load_ptms"><a class="viewcode-back" href="../../index.html#pex100.Pex100.load_ptms">[docs]</a>    <span class="k">def</span> <span class="nf">load_ptms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Obtains a list of all kinase-substrate interactions from</span>
<span class="sd">        Signor, phosphoELM, PhosphoSite and dbPTM.</span>
<span class="sd">        Creates a dict `dPhosDb` where (kinase, substrate) UniProts are keys</span>
<span class="sd">        and list of PTMs are values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dPhosDb</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ncbi_tax_id</span> <span class="o">==</span> <span class="mi">10090</span><span class="p">:</span>
            <span class="n">lKinSub</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pa</span><span class="o">.</span><span class="n">load_signor_ptms</span><span class="p">(</span><span class="n">return_raw</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pa</span><span class="o">.</span><span class="n">load_phosphoelm</span><span class="p">(</span><span class="n">return_raw</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pa</span><span class="o">.</span><span class="n">load_dbptm</span><span class="p">(</span><span class="n">return_raw</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pa</span><span class="o">.</span><span class="n">load_psite_phos</span><span class="p">(</span><span class="n">return_raw</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lKinSub</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pa</span><span class="o">.</span><span class="n">load_signor_ptms</span><span class="p">(</span><span class="n">return_raw</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pa</span><span class="o">.</span><span class="n">load_li2012_ptms</span><span class="p">(</span><span class="n">return_raw</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pa</span><span class="o">.</span><span class="n">load_hprd_ptms</span><span class="p">(</span><span class="n">return_raw</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pa</span><span class="o">.</span><span class="n">load_mimp_dmi</span><span class="p">(</span><span class="n">return_raw</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pa</span><span class="o">.</span><span class="n">load_pnetworks_dmi</span><span class="p">(</span><span class="n">return_raw</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pa</span><span class="o">.</span><span class="n">load_phosphoelm</span><span class="p">(</span><span class="n">return_raw</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pa</span><span class="o">.</span><span class="n">load_dbptm</span><span class="p">(</span><span class="n">return_raw</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pa</span><span class="o">.</span><span class="n">load_psite_phos</span><span class="p">(</span><span class="n">return_raw</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="p">)</span>
        
        <span class="k">for</span> <span class="n">ksub</span> <span class="ow">in</span> <span class="n">lKinSub</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ksub</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">protein</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dPhosDb</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dPhosDb</span><span class="p">[</span><span class="n">ksub</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">protein</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dPhosDb</span><span class="p">[</span><span class="n">ksub</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">protein</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ksub</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="Pex100.load_seq"><a class="viewcode-back" href="../../index.html#pex100.Pex100.load_seq">[docs]</a>    <span class="k">def</span> <span class="nf">load_seq</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads protein sequences from UniProt.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dSeq</span> <span class="o">=</span> <span class="n">pypath</span><span class="o">.</span><span class="n">uniprot_input</span><span class="o">.</span><span class="n">swissprot_seq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ncbi_tax_id</span><span class="p">,</span>
                                                       <span class="n">isoforms</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="Pex100.create_ptms"><a class="viewcode-back" href="../../index.html#pex100.Pex100.create_ptms">[docs]</a>    <span class="k">def</span> <span class="nf">create_ptms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates PTM objects for each PTM on array.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dAssaySub</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setSeqMismatch</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setSeqMismatchName</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">4</span><span class="p">]),</span>
                                          <span class="bp">self</span><span class="o">.</span><span class="n">aPsiteAnnot</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setSeqMismatchOrg</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setSeqMismatchNameOrg</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span>
                                      <span class="nb">filter</span><span class="p">(</span>
                                          <span class="k">lambda</span> <span class="n">k</span><span class="p">:</span>
                                              <span class="bp">self</span><span class="o">.</span><span class="n">ncbi_tax_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dOrgSpec</span><span class="p">[</span><span class="n">k</span><span class="p">],</span>
                                            <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">4</span><span class="p">]),</span>
                                                <span class="bp">self</span><span class="o">.</span><span class="n">aPsiteAnnot</span><span class="p">)</span>
                                        <span class="p">))</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">dResUpdate</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="k">for</span> <span class="n">psite</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">aPsiteAnnot</span><span class="p">:</span>
            
            <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">psite</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">psite</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">psite</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
            <span class="n">nkey</span> <span class="o">=</span> <span class="p">(</span><span class="n">psite</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">psite</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">psite</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
            
            <span class="c1"># </span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setSeqMismatch</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">psite</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dSeq</span><span class="p">:</span>
                
                <span class="k">for</span> <span class="n">isof</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dSeq</span><span class="p">[</span><span class="n">psite</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">isoforms</span><span class="p">():</span>
                    
                    <span class="n">resnum</span> <span class="o">=</span> <span class="n">psite</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
                    <span class="n">resaa</span> <span class="o">=</span> <span class="n">psite</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                    
                    <span class="k">if</span> <span class="p">(</span><span class="n">psite</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">resnum</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dAssayRefCorrection</span> <span class="ow">and</span> \
                        <span class="bp">self</span><span class="o">.</span><span class="n">ncbi_tax_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dAssayRefCorrection</span><span class="p">[</span>
                        <span class="p">(</span><span class="n">psite</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">resnum</span><span class="p">)]:</span>
                        
                        <span class="n">resaa</span><span class="p">,</span> <span class="n">resnum</span> <span class="o">=</span> \
                            <span class="bp">self</span><span class="o">.</span><span class="n">dAssayRefCorrection</span><span class="p">[(</span><span class="n">psite</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">resnum</span><span class="p">)][</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">ncbi_tax_id</span><span class="p">]</span>
                    
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">dSeq</span><span class="p">[</span><span class="n">psite</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">resaa</span><span class="p">,</span>
                                                     <span class="n">resnum</span><span class="p">,</span> <span class="n">isoform</span> <span class="o">=</span> <span class="n">isof</span><span class="p">):</span>
                        <span class="n">resnum</span> <span class="o">=</span> <span class="n">psite</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">flex_resnum</span> <span class="ow">or</span> \
                            <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">dSeq</span><span class="p">[</span><span class="n">psite</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">resaa</span><span class="p">,</span>
                                                     <span class="n">resnum</span><span class="p">,</span> <span class="n">isoform</span> <span class="o">=</span> <span class="n">isof</span><span class="p">):</span>
                            <span class="k">continue</span>
                        
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dSeq</span><span class="p">[</span><span class="n">psite</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">resaa</span><span class="p">,</span>
                                                     <span class="n">resnum</span><span class="p">,</span> <span class="n">isoform</span> <span class="o">=</span> <span class="n">isof</span><span class="p">):</span>
                        
                        <span class="c1"># updating the residue number in array</span>
                        <span class="k">if</span> <span class="n">resnum</span> <span class="o">!=</span> <span class="n">psite</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">dResUpdate</span><span class="p">[(</span><span class="n">psite</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">psite</span><span class="p">[</span><span class="mi">4</span><span class="p">])]</span> <span class="o">=</span> \
                                <span class="p">(</span><span class="n">psite</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">resnum</span><span class="p">)</span>
                            <span class="n">psite</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">resnum</span>
                        
                        <span class="n">res</span> <span class="o">=</span> <span class="n">pypath</span><span class="o">.</span><span class="n">intera</span><span class="o">.</span><span class="n">Residue</span><span class="p">(</span><span class="n">resnum</span><span class="p">,</span>
                                                    <span class="n">resaa</span><span class="p">,</span>
                                                    <span class="n">psite</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                    <span class="n">isoform</span> <span class="o">=</span> <span class="n">isof</span><span class="p">)</span>
                        <span class="n">reg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dSeq</span><span class="p">[</span><span class="n">psite</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">get_region</span><span class="p">(</span>
                            <span class="n">residue</span> <span class="o">=</span> <span class="n">resnum</span><span class="p">,</span> <span class="n">flanking</span> <span class="o">=</span> <span class="mi">7</span><span class="p">,</span> <span class="n">isoform</span> <span class="o">=</span> <span class="n">isof</span><span class="p">)</span>
                        <span class="n">mot</span> <span class="o">=</span> <span class="n">pypath</span><span class="o">.</span><span class="n">intera</span><span class="o">.</span><span class="n">Motif</span><span class="p">(</span><span class="n">psite</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">reg</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">reg</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                                  <span class="n">instance</span> <span class="o">=</span> <span class="n">reg</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                                                  <span class="n">isoform</span> <span class="o">=</span> <span class="n">isof</span><span class="p">)</span>
                        <span class="n">ptm</span> <span class="o">=</span> <span class="n">pypath</span><span class="o">.</span><span class="n">intera</span><span class="o">.</span><span class="n">Ptm</span><span class="p">(</span><span class="n">psite</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                <span class="n">residue</span> <span class="o">=</span> <span class="n">res</span><span class="p">,</span>
                                                <span class="n">motif</span> <span class="o">=</span> <span class="n">mot</span><span class="p">,</span>
                                                <span class="n">typ</span> <span class="o">=</span> <span class="s1">&#39;phosphorylation&#39;</span><span class="p">,</span>
                                                <span class="n">isoform</span> <span class="o">=</span> <span class="n">isof</span><span class="p">)</span>
                        
                        <span class="k">if</span> <span class="n">psite</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dAssaySub</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">dAssaySub</span><span class="p">[</span><span class="n">psite</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">dAssaySub</span><span class="p">[</span><span class="n">psite</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ptm</span><span class="p">)</span>
                        
                        <span class="c1"># this matched once, so removed to</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">setSeqMismatch</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">nkey</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">setSeqMismatchName</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">setSeqMismatchName</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">nkey</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">nkey</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">setSeqMismatchNameOrg</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">setSeqMismatchNameOrg</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">nkey</span><span class="p">)</span>
                        
                        <span class="k">break</span> <span class="c1"># process only the first matching isoform</span>
            
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">!! No sequence available for </span><span class="si">%s</span><span class="s1">!</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> \
                    <span class="n">psite</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">setSeqMismatch</span><span class="p">:</span>
                
                <span class="c1"># here the organism matches, but the sequence mismatches:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ncbi_tax_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dOrgSpec</span><span class="p">[</span><span class="n">nkey</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">setSeqMismatchOrg</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            
        <span class="c1"># updating residue numbers in all arrays:</span>
        <span class="c1"># arrays</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">aSignalAnnot</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">aCvarAnnot</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">aNormAnnot</span><span class="p">]:</span>
            <span class="c1"># rows</span>
            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">a</span><span class="p">:</span>
                <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dResUpdate</span><span class="p">:</span>
                    <span class="n">r</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dResUpdate</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dOrgSpecUniprot</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">k</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dResUpdate</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dOrgSpecUniprot</span><span class="p">[(</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">dResUpdate</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">1</span><span class="p">])]</span> <span class="o">=</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">dOrgSpecUniprot</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">dOrgSpecUniprot</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></div>
    
<div class="viewcode-block" id="Pex100.combined_table"><a class="viewcode-back" href="../../index.html#pex100.Pex100.combined_table">[docs]</a>    <span class="k">def</span> <span class="nf">combined_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">to_file</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Export a table with number of kinases for each substrate PTM.</span>
<span class="sd">        The table will be saved into `daTable` attribute, which is a</span>
<span class="sd">        dict of arrays.</span>
<span class="sd">        </span>
<span class="sd">        :param bool to_file: Whether to write table into file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">def</span> <span class="nf">get_pratio</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">ckey</span><span class="p">,</span> <span class="n">pkey</span><span class="p">,</span> <span class="n">lnums</span><span class="p">,</span> <span class="n">cnum</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">a</span><span class="p">[</span><span class="n">lnums</span><span class="p">[</span><span class="n">pkey</span><span class="p">],</span><span class="n">cnum</span><span class="p">]</span> <span class="o">/</span> <span class="n">a</span><span class="p">[</span><span class="n">lnums</span><span class="p">[</span><span class="n">ckey</span><span class="p">],</span><span class="n">cnum</span><span class="p">]</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">lCombinedHdr</span> <span class="o">=</span> <span class="p">[</span>
                          <span class="s1">&#39;uniprot&#39;</span><span class="p">,</span> <span class="s1">&#39;gsymbol&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;numof_kin&#39;</span><span class="p">,</span> <span class="s1">&#39;degree&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;resaa&#39;</span><span class="p">,</span> <span class="s1">&#39;resnum&#39;</span><span class="p">,</span> <span class="s1">&#39;group&#39;</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;original_resnum&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;std_gapdh&#39;</span><span class="p">,</span> <span class="s1">&#39;std_actin&#39;</span><span class="p">,</span> <span class="s1">&#39;std_pkc&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;signal&#39;</span><span class="p">,</span> <span class="s1">&#39;ctrl_signal&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;cv&#39;</span><span class="p">,</span> <span class="s1">&#39;ctrl_cv&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;norm&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;norm_actin&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;norm_gapdh&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;norm_pkc&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;ctrl_norm&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;ctrl_norm_actin&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;ctrl_norm_gapdh&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;ctrl_norm_pkc&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;phos&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;pratio&#39;</span><span class="p">,</span> <span class="s1">&#39;ctrl_pratio&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;pratio_actin&#39;</span><span class="p">,</span> <span class="s1">&#39;ctrl_pratio_actin&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;pratio_gapdh&#39;</span><span class="p">,</span> <span class="s1">&#39;ctrl_pratio_gapdh&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;pratio_pkc&#39;</span><span class="p">,</span> <span class="s1">&#39;ctrl_pratio_pkc&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;fc&#39;</span><span class="p">,</span> <span class="s1">&#39;fc_actin&#39;</span><span class="p">,</span> <span class="s1">&#39;fc_gapdh&#39;</span><span class="p">,</span> <span class="s1">&#39;fc_pkc&#39;</span>
                          <span class="p">]</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">lSingleHdr</span> <span class="o">=</span> <span class="p">[</span>
                          <span class="s1">&#39;uniprot&#39;</span><span class="p">,</span> <span class="s1">&#39;gsymbol&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;numof_kin&#39;</span><span class="p">,</span> <span class="s1">&#39;degree&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;resaa&#39;</span><span class="p">,</span> <span class="s1">&#39;resnum&#39;</span><span class="p">,</span> <span class="s1">&#39;group&#39;</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;original_resnum&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;phos&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;cv&#39;</span><span class="p">,</span> <span class="s1">&#39;ctrl_cv&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;std_name&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;std_signal&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;norm&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;ctrl&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;sd_treat&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;sd_ctrl&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;pratio&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;ctrl_pratio&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;fc&#39;</span>
                          <span class="p">]</span>
        
        <span class="c1"># initializing data structures</span>
        <span class="n">ctrls</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;actin&#39;</span><span class="p">:</span> <span class="s1">&#39;Beta actin&#39;</span><span class="p">,</span>
            <span class="s1">&#39;gapdh&#39;</span><span class="p">:</span> <span class="s1">&#39;GAPDH&#39;</span><span class="p">,</span>
            <span class="s1">&#39;pkc&#39;</span><span class="p">:</span>   <span class="s1">&#39;PKC pan activation site&#39;</span>
        <span class="p">}</span>
        
        <span class="n">dllCombined</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;none&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;actin&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;gapdh&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;pkc&#39;</span><span class="p">:</span> <span class="p">[]}</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">daSignalNorm</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">daStd</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="n">dDataLnum</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">i</span><span class="p">:</span>
                                 <span class="p">(</span>
                                    <span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span>
                                    <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">4</span><span class="p">],</span>
                                    <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">6</span><span class="p">]</span> <span class="c1"># the original residue numbers</span>
                                    <span class="p">),</span>
                                    <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># the row number</span>
                                 <span class="p">),</span>
                             <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aSignalAnnot</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dDataLnum</span> <span class="o">=</span> <span class="n">dDataLnum</span>
        
        <span class="c1"># standards values normalized by their min</span>
        <span class="k">for</span> <span class="n">stdshort</span> <span class="ow">in</span> <span class="n">ctrls</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">daStd</span><span class="p">[</span><span class="n">stdshort</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dStd</span><span class="p">[</span><span class="s1">&#39;Signal&#39;</span><span class="p">][</span><span class="n">ctrls</span><span class="p">[</span><span class="n">stdshort</span><span class="p">]])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">daStd</span><span class="p">[</span><span class="n">stdshort</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">daStd</span><span class="p">[</span><span class="n">stdshort</span><span class="p">]</span> <span class="o">/</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">daStd</span><span class="p">[</span><span class="n">stdshort</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
        
        <span class="c1"># normalized to standard</span>
        <span class="k">for</span> <span class="n">stdshort</span> <span class="ow">in</span> <span class="n">ctrls</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            
            <span class="c1">#self.daSignalNorm[stdshort] = self.aSignalData / self.daStd[stdshort]</span>
            <span class="c1"># normalized to median</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">daSignalNorm</span><span class="p">[</span><span class="n">stdshort</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">aSignalData</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aSignalData</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">daSignalNorm</span><span class="p">[</span><span class="n">stdshort</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">daSignalNorm</span><span class="p">[</span><span class="n">stdshort</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">daStd</span><span class="p">[</span><span class="n">stdshort</span><span class="p">]</span>
            <span class="c1">#self.daSignalNorm[stdshort] = (self.daSignalNorm[stdshort] /</span>
            <span class="c1">#                               np.median(self.daSignalNorm[stdshort],</span>
            <span class="c1">#                                         axis = 0))</span>
        
        <span class="c1"># degree of freedom</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">aPsiteAnnot</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">cntrUniqueLabels</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">Counter</span><span class="p">()</span>
        
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">annot</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aPsiteAnnot</span><span class="p">):</span>
            
            <span class="n">uniprot</span> <span class="o">=</span> <span class="n">annot</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">gss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pa</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">uniprot</span><span class="p">,</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">,</span>
                                          <span class="s1">&#39;genesymbol&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ncbi_tax_id</span><span class="p">)</span>
            <span class="n">genesymbol</span> <span class="o">=</span> <span class="n">gss</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">gss</span><span class="p">)</span> <span class="k">else</span> <span class="n">uniprot</span>
            <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">uniprot</span><span class="p">,</span> <span class="n">annot</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">annot</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
            <span class="n">pkey</span> <span class="o">=</span> <span class="p">(</span><span class="n">uniprot</span><span class="p">,</span> <span class="s1">&#39;Phospho&#39;</span><span class="p">,</span> <span class="n">annot</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">annot</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">annot</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
            <span class="n">ckey</span> <span class="o">=</span> <span class="p">(</span><span class="n">uniprot</span><span class="p">,</span> <span class="s1">&#39;Ab&#39;</span><span class="p">,</span>      <span class="s1">&#39;&#39;</span><span class="p">,</span>       <span class="n">annot</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">annot</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
            <span class="n">degree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pa</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">uniprot</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">degree</span><span class="p">()</span> \
                <span class="k">if</span> <span class="n">uniprot</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pa</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="mi">0</span>
            
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dKinNum</span><span class="p">:</span>
                <span class="c1"># this verifies that the phosphorylated residue</span>
                <span class="c1"># has been found in the UniProt sequence</span>
                <span class="k">continue</span>
            
            <span class="n">dCtrlPratio</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;none&#39;</span><span class="p">:</span> <span class="n">get_pratio</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aSignalData</span><span class="p">,</span>
                                              <span class="n">ckey</span><span class="p">,</span> <span class="n">pkey</span><span class="p">,</span> <span class="n">dDataLnum</span><span class="p">,</span> <span class="mi">0</span><span class="p">)}</span>
            
            <span class="c1"># get the unique label</span>
            <span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">antibody_id_to_name</span><span class="p">(</span><span class="n">annot</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
            
            <span class="c1"># phosphorylation ratios for each standards</span>
            <span class="k">for</span> <span class="n">stdshort</span> <span class="ow">in</span> <span class="n">ctrls</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                
                <span class="n">dCtrlPratio</span><span class="p">[</span><span class="n">stdshort</span><span class="p">]</span> <span class="o">=</span> \
                    <span class="n">get_pratio</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">daSignalNorm</span><span class="p">[</span><span class="n">stdshort</span><span class="p">],</span>
                               <span class="n">ckey</span><span class="p">,</span> <span class="n">pkey</span><span class="p">,</span> <span class="n">dDataLnum</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            
            <span class="k">for</span> <span class="n">group</span><span class="p">,</span> <span class="n">cnum</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lDataCols</span><span class="p">:</span>
                
                <span class="n">dPratio</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;none&#39;</span><span class="p">:</span> <span class="n">get_pratio</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aNormData</span><span class="p">,</span>
                                              <span class="n">ckey</span><span class="p">,</span> <span class="n">pkey</span><span class="p">,</span>
                                              <span class="n">dDataLnum</span><span class="p">,</span> <span class="n">cnum</span><span class="p">)}</span>
                
                <span class="c1"># phosphorylation ratios for each standards</span>
                <span class="k">for</span> <span class="n">stdshort</span> <span class="ow">in</span> <span class="n">ctrls</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    
                    <span class="n">dPratio</span><span class="p">[</span><span class="n">stdshort</span><span class="p">]</span> <span class="o">=</span> \
                        <span class="n">get_pratio</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">daSignalNorm</span><span class="p">[</span><span class="n">stdshort</span><span class="p">],</span>
                                <span class="n">ckey</span><span class="p">,</span> <span class="n">pkey</span><span class="p">,</span> <span class="n">dDataLnum</span><span class="p">,</span> <span class="n">cnum</span><span class="p">)</span>
                
                <span class="k">for</span> <span class="n">dkey</span><span class="p">,</span> <span class="n">phos</span> <span class="ow">in</span> <span class="p">[(</span><span class="n">ckey</span><span class="p">,</span> <span class="s1">&#39;np&#39;</span><span class="p">),</span> <span class="p">(</span><span class="n">pkey</span><span class="p">,</span> <span class="s1">&#39;p&#39;</span><span class="p">)]:</span>
                    
                    <span class="n">common_fields</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="n">uniprot</span><span class="p">,</span>
                        <span class="n">genesymbol</span><span class="p">,</span>
                        <span class="n">annot</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">dKinNum</span><span class="p">[</span><span class="n">key</span><span class="p">],</span>
                        <span class="n">degree</span><span class="p">,</span>
                        <span class="n">annot</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
                        <span class="n">annot</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span>
                        <span class="n">group</span><span class="p">,</span>
                        <span class="n">label</span><span class="p">,</span>
                        <span class="n">annot</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span>
                        <span class="n">phos</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">aCvarData</span><span class="p">[</span><span class="n">dDataLnum</span><span class="p">[</span><span class="n">dkey</span><span class="p">],</span><span class="n">cnum</span><span class="p">],</span> <span class="c1"># CV treatment</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">aCvarData</span><span class="p">[</span><span class="n">dDataLnum</span><span class="p">[</span><span class="n">dkey</span><span class="p">],</span><span class="mi">0</span><span class="p">]</span>     <span class="c1"># CV control</span>
                        <span class="c1"># 10 (index)</span>
                    <span class="p">]</span>
                    
                    <span class="n">dllCombined</span><span class="p">[</span><span class="s1">&#39;none&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">common_fields</span> <span class="o">+</span> <span class="p">[</span>
                        
                            <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="c1"># name of the standard</span>
                            <span class="mf">1.0</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">aSignalData</span><span class="p">[</span><span class="n">dDataLnum</span><span class="p">[</span><span class="n">dkey</span><span class="p">],</span><span class="n">cnum</span><span class="p">],</span> <span class="c1"># signal</span>
                                                                    <span class="c1"># in treat</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">aSignalData</span><span class="p">[</span><span class="n">dDataLnum</span><span class="p">[</span><span class="n">dkey</span><span class="p">],</span><span class="mi">0</span><span class="p">],</span> <span class="c1"># signal</span>
                                                                 <span class="c1"># in control</span>
                            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aCvarData</span><span class="p">[</span><span class="n">dDataLnum</span><span class="p">[</span><span class="n">dkey</span><span class="p">],</span><span class="n">cnum</span><span class="p">]</span> <span class="o">*</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">aSignalData</span><span class="p">[</span><span class="n">dDataLnum</span><span class="p">[</span><span class="n">dkey</span><span class="p">],</span><span class="n">cnum</span><span class="p">]),</span> <span class="c1"># SD tr</span>
                            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aCvarData</span><span class="p">[</span><span class="n">dDataLnum</span><span class="p">[</span><span class="n">dkey</span><span class="p">],</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">aSignalData</span><span class="p">[</span><span class="n">dDataLnum</span><span class="p">[</span><span class="n">dkey</span><span class="p">],</span><span class="mi">0</span><span class="p">]),</span> <span class="c1"># SD co</span>
                            <span class="n">dPratio</span><span class="p">[</span><span class="s1">&#39;none&#39;</span><span class="p">],</span> <span class="c1"># ratio of phosphorylated</span>
                            <span class="n">dCtrlPratio</span><span class="p">[</span><span class="s1">&#39;none&#39;</span><span class="p">],</span> <span class="c1"># r. of ph. in control</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">fold_change</span><span class="p">(</span>
                                <span class="n">dPratio</span><span class="p">[</span><span class="s1">&#39;none&#39;</span><span class="p">],</span>
                                <span class="n">dCtrlPratio</span><span class="p">[</span><span class="s1">&#39;none&#39;</span><span class="p">]</span>
                            <span class="p">)</span> <span class="c1"># FC</span>
                        <span class="p">]</span>
                    <span class="p">)</span>
                    
                    <span class="k">for</span> <span class="n">stdshort</span><span class="p">,</span> <span class="n">stdname</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">ctrls</span><span class="p">):</span>
                        
                        <span class="n">dllCombined</span><span class="p">[</span><span class="n">stdshort</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="n">common_fields</span> <span class="o">+</span> <span class="p">[</span>
                                
                                <span class="n">stdshort</span><span class="p">,</span> <span class="c1"># name of the standard</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">dStd</span><span class="p">[</span><span class="s1">&#39;Signal&#39;</span><span class="p">][</span><span class="n">stdname</span><span class="p">][</span><span class="n">cnum</span><span class="p">],</span> <span class="c1"># standard</span>
                                                                    <span class="c1"># signal</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">daSignalNorm</span><span class="p">[</span><span class="n">stdshort</span><span class="p">][</span>
                                    <span class="n">dDataLnum</span><span class="p">[</span><span class="n">dkey</span><span class="p">],</span><span class="n">cnum</span><span class="p">],</span> <span class="c1"># signal in treat.</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">daSignalNorm</span><span class="p">[</span><span class="n">stdshort</span><span class="p">][</span>
                                    <span class="n">dDataLnum</span><span class="p">[</span><span class="n">dkey</span><span class="p">],</span><span class="mi">0</span><span class="p">],</span> <span class="c1"># signal in control</span>
                                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aCvarData</span><span class="p">[</span><span class="n">dDataLnum</span><span class="p">[</span><span class="n">dkey</span><span class="p">],</span><span class="n">cnum</span><span class="p">]</span> <span class="o">*</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">daSignalNorm</span><span class="p">[</span><span class="n">stdshort</span><span class="p">][</span>
                                    <span class="n">dDataLnum</span><span class="p">[</span><span class="n">dkey</span><span class="p">],</span><span class="n">cnum</span><span class="p">]),</span> <span class="c1"># SD tr</span>
                                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aCvarData</span><span class="p">[</span><span class="n">dDataLnum</span><span class="p">[</span><span class="n">dkey</span><span class="p">],</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">daSignalNorm</span><span class="p">[</span><span class="n">stdshort</span><span class="p">][</span>
                                    <span class="n">dDataLnum</span><span class="p">[</span><span class="n">dkey</span><span class="p">],</span><span class="mi">0</span><span class="p">]),</span> <span class="c1"># SD co</span>
                                <span class="n">dPratio</span><span class="p">[</span><span class="n">stdshort</span><span class="p">],</span> <span class="c1"># ratio of phosphorylated</span>
                                <span class="n">dCtrlPratio</span><span class="p">[</span><span class="n">stdshort</span><span class="p">],</span> <span class="c1"># r. of ph. in control</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">fold_change</span><span class="p">(</span>
                                    <span class="n">dPratio</span><span class="p">[</span><span class="n">stdshort</span><span class="p">],</span>
                                    <span class="n">dCtrlPratio</span><span class="p">[</span><span class="n">stdshort</span><span class="p">]</span>
                                <span class="p">)</span><span class="c1"># FC</span>
                            <span class="p">]</span>
                        <span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">dllCombined</span> <span class="o">=</span> <span class="n">dllCombined</span>
        
        <span class="c1"># make all to numpy array</span>
        <span class="k">for</span> <span class="n">std</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dllCombined</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">dllCombined</span><span class="p">[</span><span class="n">std</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dllCombined</span><span class="p">[</span><span class="n">std</span><span class="p">],</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">object</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">daCombined</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dllCombined</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">dllCombined</span>
        
        <span class="c1"># write the table to outfile</span>
        <span class="k">if</span> <span class="n">to_file</span><span class="p">:</span>
            
            <span class="k">for</span> <span class="n">std</span><span class="p">,</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">daCombined</span><span class="p">):</span>
                
                <span class="n">fname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fnCombined</span> <span class="o">%</span> <span class="n">std</span>
                
                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">:: Writing to `</span><span class="si">%s</span><span class="s1">`.</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">fname</span><span class="p">)</span>
                
                <span class="bp">self</span><span class="o">.</span><span class="n">table_to_file</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lSingleHdr</span><span class="p">)</span></div>
    
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="Pex100.fold_change"><a class="viewcode-back" href="../../index.html#pex100.Pex100.fold_change">[docs]</a>    <span class="k">def</span> <span class="nf">fold_change</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">ctrl</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates the fold change as {value}/{control} if </span>
<span class="sd">        {control} &lt; {value} and -1 * {control}/{value} otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> \
            <span class="mf">0.0</span> <span class="k">if</span> <span class="n">val</span> <span class="o">==</span> <span class="n">ctrl</span> \
            <span class="k">else</span>  <span class="n">val</span> <span class="o">/</span> <span class="n">ctrl</span> <span class="k">if</span> <span class="n">ctrl</span> <span class="o">&lt;</span> <span class="n">val</span> \
            <span class="k">else</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">ctrl</span> <span class="o">/</span> <span class="n">val</span></div>
    
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="Pex100.log2_fold_change"><a class="viewcode-back" href="../../index.html#pex100.Pex100.log2_fold_change">[docs]</a>    <span class="k">def</span> <span class="nf">log2_fold_change</span><span class="p">(</span><span class="n">fc</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Log2 transforms fold change value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="mf">1.0</span> <span class="k">if</span> <span class="n">fc</span> <span class="o">==</span> <span class="mf">0.0</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">fc</span><span class="p">)</span> <span class="k">if</span> <span class="n">fc</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">/</span> <span class="n">fc</span><span class="p">)</span></div>
    
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="Pex100.table_to_file"><a class="viewcode-back" href="../../index.html#pex100.Pex100.table_to_file">[docs]</a>    <span class="k">def</span> <span class="nf">table_to_file</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">arr</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">hdr</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes contents of an array into file with header optionally.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">sTable</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">array_to_string</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">hdr</span><span class="p">)</span>
        
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            
            <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">sTable</span><span class="p">)</span></div>
    
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="Pex100.array_to_string"><a class="viewcode-back" href="../../index.html#pex100.Pex100.array_to_string">[docs]</a>    <span class="k">def</span> <span class="nf">array_to_string</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">arr</span><span class="p">,</span> <span class="n">hdr</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Takes a numpy array and returns it as a string of tabular.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">sHdr</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        
        <span class="k">if</span> <span class="n">hdr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            
            <span class="n">sHdr</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">hdr</span><span class="p">)</span>
        
        <span class="n">lls</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">array_to_lls</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
        
        <span class="n">sMain</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">row</span><span class="p">),</span> <span class="n">lls</span><span class="p">))</span>
        
        <span class="k">return</span> <span class="s1">&#39;</span><span class="si">%s%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sHdr</span><span class="p">,</span> <span class="n">sMain</span><span class="p">)</span></div>
    
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="Pex100.array_to_lls"><a class="viewcode-back" href="../../index.html#pex100.Pex100.array_to_lls">[docs]</a>    <span class="k">def</span> <span class="nf">array_to_lls</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">arr</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts numpy array to a list of lists of strings.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> \
            <span class="nb">list</span><span class="p">(</span>
                <span class="nb">map</span><span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span>
                        <span class="nb">list</span><span class="p">(</span>
                            <span class="nb">map</span><span class="p">(</span>
                                <span class="bp">cls</span><span class="o">.</span><span class="n">to_string</span><span class="p">,</span>
                                <span class="n">row</span>
                            <span class="p">)</span>
                        <span class="p">),</span>
                    <span class="n">arr</span>
                <span class="p">)</span>
            <span class="p">)</span></div>
    
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="Pex100.to_string"><a class="viewcode-back" href="../../index.html#pex100.Pex100.to_string">[docs]</a>    <span class="k">def</span> <span class="nf">to_string</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts simple values to strings a uniform way.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span>
                <span class="p">(</span><span class="s1">&#39;</span><span class="si">%.08f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">val</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">float</span>
                <span class="k">else</span> <span class="p">(</span><span class="s1">&#39;</span><span class="si">%u</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">val</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span>
                <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
            <span class="p">)</span></div>
    
<div class="viewcode-block" id="Pex100.fc_table"><a class="viewcode-back" href="../../index.html#pex100.Pex100.fc_table">[docs]</a>    <span class="k">def</span> <span class="nf">fc_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">to_file</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates tables with fold changes, and exports to files optionally.</span>
<span class="sd">        Calculates z-scores, p-values and t-values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">daFcTable</span>       <span class="o">=</span> <span class="p">{}</span>
        <span class="n">daPTopFcTable</span>   <span class="o">=</span> <span class="p">{}</span>
        <span class="n">daUniqueFcTable</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">daPSTopFcTable</span>  <span class="o">=</span> <span class="p">{}</span>
        
        <span class="k">for</span> <span class="n">std</span><span class="p">,</span> <span class="n">tbl</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">daCombined</span><span class="p">):</span>
            
            <span class="n">daFcTable</span><span class="p">[</span><span class="n">std</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            
            <span class="k">for</span> <span class="n">treat</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lDataCols</span><span class="p">:</span>
                
                <span class="k">if</span> <span class="n">treat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Control&#39;</span><span class="p">:</span>
                    <span class="k">continue</span>
                
                <span class="n">daFcTable</span><span class="p">[</span><span class="n">std</span><span class="p">][</span><span class="n">treat</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
                
                <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="n">tbl</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">tbl</span><span class="p">[:,</span><span class="mi">7</span><span class="p">]</span> <span class="o">==</span> <span class="n">treat</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                      <span class="n">tbl</span><span class="p">[:,</span><span class="mi">10</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;p&#39;</span><span class="p">))]:</span>
                    
                    <span class="c1"># uniprot, genesymbol, name,</span>
                    <span class="c1"># resaa, resnum, label, fold change</span>
                    <span class="n">daFcTable</span><span class="p">[</span><span class="n">std</span><span class="p">][</span><span class="n">treat</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="p">[</span>
                            <span class="n">it</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">it</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                            <span class="n">it</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">it</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span>
                            <span class="n">it</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">it</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span>
                            <span class="n">it</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span>
                            <span class="p">(</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">effect_as_int</span><span class="p">(</span><span class="n">it</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">it</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">it</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
                                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;lAllKinases&#39;</span><span class="p">)</span>
                                <span class="k">else</span> <span class="mi">0</span>
                            <span class="p">),</span>
                            <span class="n">it</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                        <span class="p">])</span>
                
                <span class="n">daFcTable</span><span class="p">[</span><span class="n">std</span><span class="p">][</span><span class="n">treat</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">daFcTable</span><span class="p">[</span><span class="n">std</span><span class="p">][</span><span class="n">treat</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                                                    <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">object</span><span class="p">)</span>
                
                <span class="n">logfc</span> <span class="o">=</span> \
                    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                        <span class="nb">list</span><span class="p">(</span>
                            <span class="nb">map</span><span class="p">(</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">log2_fold_change</span><span class="p">,</span>
                                <span class="n">daFcTable</span><span class="p">[</span><span class="n">std</span><span class="p">][</span><span class="n">treat</span><span class="p">[</span><span class="mi">0</span><span class="p">]][:,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                            <span class="p">)</span>
                        <span class="p">),</span>
                        <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span>
                    <span class="p">)</span>
                
                <span class="n">sd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">logfc</span><span class="p">)</span>
                
                <span class="n">zscore</span> <span class="o">=</span> <span class="n">logfc</span> <span class="o">/</span> <span class="n">sd</span>
                
                <span class="n">ndist</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="p">()</span>
                
                <span class="n">pval</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">ndist</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">zscore</span><span class="p">))</span>
                
                <span class="n">df</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">daFcTable</span><span class="p">[</span><span class="n">std</span><span class="p">][</span><span class="n">treat</span><span class="p">[</span><span class="mi">0</span><span class="p">]][:,</span><span class="mi">2</span><span class="p">]))</span> <span class="o">-</span> <span class="mi">1</span>
                
                <span class="n">tdist</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">t</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
                
                <span class="n">tval</span> <span class="o">=</span> <span class="n">tdist</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">pval</span><span class="p">)</span>
                
                <span class="n">shape</span> <span class="o">=</span> <span class="p">[</span><span class="n">daFcTable</span><span class="p">[</span><span class="n">std</span><span class="p">][</span><span class="n">treat</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">]</span>
                
                <span class="n">daFcTable</span><span class="p">[</span><span class="n">std</span><span class="p">][</span><span class="n">treat</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> \
                    <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span>
                        <span class="n">daFcTable</span><span class="p">[</span><span class="n">std</span><span class="p">][</span><span class="n">treat</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                        <span class="n">logfc</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">shape</span><span class="p">),</span>
                        <span class="n">zscore</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">shape</span><span class="p">),</span>
                        <span class="n">pval</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">shape</span><span class="p">),</span>
                        <span class="n">tval</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
                    <span class="p">))</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">daFcTable</span> <span class="o">=</span> <span class="n">daFcTable</span>
    
        <span class="c1"># selecting the psite with lowest p-value for each protein</span>
        
        <span class="k">for</span> <span class="n">std</span><span class="p">,</span> <span class="n">arrs</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">daFcTable</span><span class="p">):</span>
            
            <span class="n">daUniqueFcTable</span><span class="p">[</span><span class="n">std</span><span class="p">]</span>  <span class="o">=</span> <span class="p">{}</span> <span class="c1"># this is unique for antibodies</span>
            <span class="n">daPTopFcTable</span><span class="p">[</span><span class="n">std</span><span class="p">]</span>    <span class="o">=</span> <span class="p">{}</span> <span class="c1"># this is unique for proteins</span>
            <span class="n">daPSTopFcTable</span><span class="p">[</span><span class="n">std</span><span class="p">]</span>   <span class="o">=</span> <span class="p">{}</span> <span class="c1"># this is unique for proteins</span>
                                       <span class="c1"># and has signs adjusted</span>
            
            <span class="k">for</span> <span class="n">tr</span><span class="p">,</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">arrs</span><span class="p">):</span>
                
                <span class="n">proteins</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">arr</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">antibodies</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">r</span><span class="p">:</span> <span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="mi">6</span><span class="p">]),</span> <span class="n">arr</span><span class="p">))</span>
                
                <span class="n">daPTopFcTable</span><span class="p">[</span><span class="n">std</span><span class="p">][</span><span class="n">tr</span><span class="p">]</span>   <span class="o">=</span> <span class="p">[]</span>
                <span class="n">daUniqueFcTable</span><span class="p">[</span><span class="n">std</span><span class="p">][</span><span class="n">tr</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">daPSTopFcTable</span><span class="p">[</span><span class="n">std</span><span class="p">][</span><span class="n">tr</span><span class="p">]</span>   <span class="o">=</span> <span class="p">[]</span>
                
                <span class="k">for</span> <span class="n">protein</span> <span class="ow">in</span> <span class="n">proteins</span><span class="p">:</span>
                    
                    <span class="n">this_protein</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">arr</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">protein</span><span class="p">)]</span>
                    
                    <span class="n">imin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">this_protein</span><span class="p">[:,</span><span class="mi">10</span><span class="p">])</span> <span class="c1"># the min p-value</span>
                    
                    <span class="n">this_protein_signed</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">this_protein</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">this_protein</span><span class="p">[:,</span><span class="mi">7</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)]</span>
                    <span class="p">)</span>
                    
                    <span class="k">if</span> <span class="n">this_protein_signed</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        
                        <span class="c1"># we have sign for at least one phosphosite</span>
                        <span class="n">simin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">this_protein_signed</span><span class="p">[:,</span><span class="mi">10</span><span class="p">])</span>
                        <span class="n">daPSTopFcTable</span><span class="p">[</span><span class="n">std</span><span class="p">][</span><span class="n">tr</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="n">this_protein_signed</span><span class="p">[</span><span class="n">simin</span><span class="p">,:]</span>
                        <span class="p">)</span>
                    
                    <span class="c1"># avoid duplicates -- only one per antibody</span>
                    <span class="c1">#if this_protein[imin, 5] not in antibodies:</span>
                    <span class="n">daPTopFcTable</span><span class="p">[</span><span class="n">std</span><span class="p">][</span><span class="n">tr</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">this_protein</span><span class="p">[</span><span class="n">imin</span><span class="p">,:])</span>
                    <span class="c1">#antibodies.add(this_protein[imin, 5])</span>
                
                <span class="k">for</span> <span class="n">ab</span> <span class="ow">in</span> <span class="n">antibodies</span><span class="p">:</span>
                    
                    <span class="n">this_ab</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">arr</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">ab</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                          <span class="n">arr</span><span class="p">[:,</span><span class="mi">6</span><span class="p">]</span> <span class="o">==</span> <span class="n">ab</span><span class="p">[</span><span class="mi">1</span><span class="p">]))]</span>
                    
                    <span class="n">daUniqueFcTable</span><span class="p">[</span><span class="n">std</span><span class="p">][</span><span class="n">tr</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">this_ab</span><span class="p">[</span><span class="mi">0</span><span class="p">,:])</span>
                
                <span class="n">daPTopFcTable</span><span class="p">[</span><span class="n">std</span><span class="p">][</span><span class="n">tr</span><span class="p">]</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">daPTopFcTable</span><span class="p">[</span><span class="n">std</span><span class="p">][</span><span class="n">tr</span><span class="p">])</span>
                <span class="n">daUniqueFcTable</span><span class="p">[</span><span class="n">std</span><span class="p">][</span><span class="n">tr</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">daUniqueFcTable</span><span class="p">[</span><span class="n">std</span><span class="p">][</span><span class="n">tr</span><span class="p">])</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">daPTopFcTable</span>   <span class="o">=</span> <span class="n">daPTopFcTable</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">daUniqueFcTable</span> <span class="o">=</span> <span class="n">daUniqueFcTable</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">daPSTopFcTable</span>  <span class="o">=</span> <span class="n">daPSTopFcTable</span>
        
        <span class="k">if</span> <span class="n">to_file</span><span class="p">:</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">fc_table_to_file</span><span class="p">(</span><span class="n">unique_proteins</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fc_table_to_file</span><span class="p">(</span><span class="n">unique_proteins</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">signed</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fc_table_to_file</span><span class="p">(</span><span class="n">unique_antibodies</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fc_table_to_file</span><span class="p">(</span><span class="n">unique_antibodies</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="Pex100.fc_table_to_file"><a class="viewcode-back" href="../../index.html#pex100.Pex100.fc_table_to_file">[docs]</a>    <span class="k">def</span> <span class="nf">fc_table_to_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                         <span class="n">unique_antibodies</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                         <span class="n">unique_proteins</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                         <span class="n">signed</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes FC tables to files.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">daFc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">daPSTopFcTable</span> <span class="k">if</span> <span class="n">unique_proteins</span> <span class="ow">and</span> <span class="n">signed</span> <span class="k">else</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">daPTopFcTable</span> <span class="k">if</span> <span class="n">unique_proteins</span> <span class="k">else</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">daUniqueFcTable</span> <span class="k">if</span> <span class="n">unique_antibodies</span> <span class="k">else</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">daFcTable</span>
        <span class="p">)</span>
        
        <span class="k">for</span> <span class="n">std</span><span class="p">,</span> <span class="n">arrs</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">daFc</span><span class="p">):</span>
            
            <span class="k">for</span> <span class="n">tr</span><span class="p">,</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">arrs</span><span class="p">):</span>
                
                <span class="n">fname</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fnFcSUTable</span> <span class="k">if</span> <span class="n">unique_proteins</span> <span class="ow">and</span> <span class="n">signed</span> <span class="k">else</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fnFcUTable</span> <span class="k">if</span> <span class="n">unique_proteins</span> <span class="k">else</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fnFcTopTable</span> <span class="k">if</span> <span class="n">unique_antibodies</span> <span class="k">else</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fnFcTable</span>
                <span class="p">)</span>
                <span class="n">fname</span> <span class="o">=</span> <span class="n">fname</span> <span class="o">%</span> <span class="p">(</span><span class="n">tr</span><span class="p">,</span> <span class="n">std</span><span class="p">)</span>
                
                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">:: Writing to `</span><span class="si">%s</span><span class="s1">`.</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">fname</span><span class="p">)</span>
                
                <span class="bp">self</span><span class="o">.</span><span class="n">table_to_file</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lFcTableHdr</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="Pex100.ptms_lookup"><a class="viewcode-back" href="../../index.html#pex100.Pex100.ptms_lookup">[docs]</a>    <span class="k">def</span> <span class="nf">ptms_lookup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Looks up the PTMs on array in the databases data.</span>
<span class="sd">        Creates list with kinase-substrate interactions</span>
<span class="sd">        targeting the substrates on array.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dKinAssaySub</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dKinNum</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="k">for</span> <span class="n">uniprot</span><span class="p">,</span> <span class="n">ptms</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dAssaySub</span><span class="p">):</span>
            
            <span class="k">if</span> <span class="n">uniprot</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dKinAssaySub</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dKinAssaySub</span><span class="p">[</span><span class="n">uniprot</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            
            <span class="n">kss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dPhosDb</span><span class="p">[</span><span class="n">uniprot</span><span class="p">]</span> <span class="k">if</span> <span class="n">uniprot</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dPhosDb</span> <span class="k">else</span> <span class="p">[]</span>
            
            <span class="k">for</span> <span class="n">ptm</span> <span class="ow">in</span> <span class="n">ptms</span><span class="p">:</span>
                
                <span class="n">nKin</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">ks</span> <span class="ow">in</span> <span class="n">kss</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">ptm</span> <span class="ow">in</span> <span class="n">ks</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">dKinAssaySub</span><span class="p">[</span><span class="n">uniprot</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ks</span><span class="p">)</span>
                        <span class="n">nKin</span> <span class="o">+=</span> <span class="mi">1</span>
                
                <span class="bp">self</span><span class="o">.</span><span class="n">dKinNum</span><span class="p">[(</span><span class="n">uniprot</span><span class="p">,</span>
                                <span class="n">ptm</span><span class="o">.</span><span class="n">residue</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                                <span class="n">ptm</span><span class="o">.</span><span class="n">residue</span><span class="o">.</span><span class="n">number</span><span class="p">)]</span> <span class="o">=</span> <span class="n">nKin</span>
        
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">:: Found </span><span class="si">%u</span><span class="s1"> kinase-substrate interactions for</span><span class="se">\n</span><span class="s1">&#39;</span>\
            <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">   </span><span class="si">%s</span><span class="s1"> phosphorylation sites.</span><span class="se">\n</span><span class="s1">&#39;</span>\
            <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">   </span><span class="si">%.02f</span><span class="s1"> kinase for one site in average.</span><span class="se">\n</span><span class="s1">&#39;</span>\
            <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">   For </span><span class="si">%u</span><span class="s1"> sites no kinase found.</span><span class="se">\n</span><span class="s1">&#39;</span>\
            <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">   Additional </span><span class="si">%u</span><span class="s1"> sites could not be found in UniProt sequences.</span><span class="se">\n</span><span class="s1">&#39;</span>\
            <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">   The total number of sites is </span><span class="si">%u</span><span class="s1">.</span><span class="se">\n</span><span class="s1">&#39;</span>\
            <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">   </span><span class="si">%u</span><span class="s1"> of these sites should be valid for this organism, and</span><span class="se">\n</span><span class="s1">&#39;</span>\
            <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">   </span><span class="si">%u</span><span class="s1"> mismatches despite should match for this organism.</span><span class="se">\n</span><span class="s1">&#39;</span>\
            <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">   Excluding redundant combinations, overall </span><span class="si">%u</span><span class="s1"> sites mismatches.</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="nb">sum</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dKinAssaySub</span><span class="o">.</span><span class="n">values</span><span class="p">())),</span>
                <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="nb">bool</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dKinNum</span><span class="o">.</span><span class="n">values</span><span class="p">()))),</span>
                <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dKinNum</span><span class="o">.</span><span class="n">values</span><span class="p">())),</span>
                <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">n</span><span class="p">:</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dKinNum</span><span class="o">.</span><span class="n">values</span><span class="p">()))),</span>
                <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">setSeqMismatch</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">aPsiteAnnot</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">p</span><span class="p">:</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">ncbi_tax_id</span> <span class="ow">in</span> \
                                        <span class="bp">self</span><span class="o">.</span><span class="n">dOrgSpecUniprot</span><span class="p">[(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">4</span><span class="p">])],</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">aPsiteAnnot</span><span class="p">))),</span>
                <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">setSeqMismatchOrg</span><span class="p">),</span>
                <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">setSeqMismatchNameOrg</span><span class="p">)</span>
            <span class="p">))</span></div>
    
<div class="viewcode-block" id="Pex100.collect_proteins"><a class="viewcode-back" href="../../index.html#pex100.Pex100.collect_proteins">[docs]</a>    <span class="k">def</span> <span class="nf">collect_proteins</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compiles a list of all kinases and substrates.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lAllProteins</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dKinAssaySub</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">|</span> \
            <span class="nb">set</span><span class="p">(</span>
                <span class="nb">list</span><span class="p">(</span>
                    <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span>
                        <span class="o">*</span><span class="nb">map</span><span class="p">(</span>
                            <span class="k">lambda</span> <span class="n">kss</span><span class="p">:</span>
                                <span class="nb">map</span><span class="p">(</span>
                                    <span class="k">lambda</span> <span class="n">ks</span><span class="p">:</span>
                                        <span class="n">ks</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">protein</span><span class="p">,</span>
                                    <span class="n">kss</span>
                                <span class="p">),</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">dKinAssaySub</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span></div>
    
    <span class="k">def</span> <span class="nf">load_network</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pfile</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">pfile</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pa</span><span class="o">.</span><span class="n">load_omnipath</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pa</span><span class="o">.</span><span class="n">init_network</span><span class="p">(</span><span class="n">pfile</span> <span class="o">=</span> <span class="n">pfile</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pa</span><span class="o">.</span><span class="n">get_directed</span><span class="p">()</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">pa</span><span class="o">.</span><span class="n">dgraph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;ptm&#39;</span><span class="p">]</span>
    
<div class="viewcode-block" id="Pex100.get_network"><a class="viewcode-back" href="../../index.html#pex100.Pex100.get_network">[docs]</a>    <span class="k">def</span> <span class="nf">get_network</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keep_also</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">step1</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                    <span class="n">more_steps</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a subnetwork based on certain criteria.</span>
<span class="sd">        </span>
<span class="sd">        :param list keep_also: List of additional vertex names</span>
<span class="sd">                               to include in core.</span>
<span class="sd">        :param bool step1: Whether include not only direct</span>
<span class="sd">                           links but one step indirect connections.</span>
<span class="sd">        :param int more_steps: Include longer indirect connections. This</span>
<span class="sd">                               param defines the number of mediator nodes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;whole&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">whole</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">whole</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pa</span><span class="o">.</span><span class="n">dgraph</span>
        
        <span class="n">new</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">whole</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pa</span><span class="o">.</span><span class="n">graph</span> <span class="o">=</span> <span class="n">new</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pa</span><span class="o">.</span><span class="n">dgraph</span> <span class="o">=</span> <span class="n">new</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pa</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pa</span><span class="o">.</span><span class="n">update_vindex</span><span class="p">()</span>
        <span class="n">vids</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">new</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="nb">range</span><span class="p">(</span><span class="n">new</span><span class="o">.</span><span class="n">vcount</span><span class="p">())))</span>
        <span class="n">keep</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">u</span><span class="p">:</span> <span class="n">vids</span><span class="p">[</span><span class="n">u</span><span class="p">],</span>
                    <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">u</span><span class="p">:</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">vids</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lAllProteins</span><span class="p">)))</span>
        <span class="n">keep_also</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">u</span><span class="p">:</span> <span class="n">vids</span><span class="p">[</span><span class="n">u</span><span class="p">],</span>
                         <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">u</span><span class="p">:</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">vids</span><span class="p">,</span> <span class="n">keep_also</span><span class="p">)))</span>
        <span class="n">all_to_keep</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">keep</span><span class="p">)</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="n">keep_also</span><span class="p">)</span>
        <span class="n">delete</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">new</span><span class="o">.</span><span class="n">vcount</span><span class="p">()))</span> <span class="o">-</span> <span class="n">all_to_keep</span>
        
        <span class="n">keep_step1</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
        <span class="k">for</span> <span class="n">vid</span> <span class="ow">in</span> <span class="n">delete</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pa</span><span class="o">.</span><span class="n">affected_by</span><span class="p">(</span><span class="n">vid</span><span class="p">)</span><span class="o">.</span><span class="n">_vs</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">all_to_keep</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pa</span><span class="o">.</span><span class="n">_affected_by</span><span class="p">(</span><span class="n">vid</span><span class="p">)</span><span class="o">.</span><span class="n">_vs</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">all_to_keep</span><span class="p">):</span>
                    <span class="n">keep_step1</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">vid</span><span class="p">)</span>
        
        <span class="n">all_to_keep</span> <span class="o">=</span> <span class="n">all_to_keep</span> <span class="o">|</span> <span class="n">keep_step1</span>
        <span class="n">delete</span> <span class="o">=</span> <span class="n">delete</span> <span class="o">-</span> <span class="n">keep_step1</span>
        
        <span class="k">if</span> <span class="n">more_steps</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            
            <span class="n">n1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pa</span><span class="o">.</span><span class="n">_neighborhood</span><span class="p">(</span><span class="n">all_to_keep</span><span class="p">,</span> <span class="n">order</span> <span class="o">=</span> <span class="n">more_steps</span><span class="p">,</span> <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;IN&#39;</span><span class="p">)</span>
            <span class="n">n2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pa</span><span class="o">.</span><span class="n">_neighborhood</span><span class="p">(</span><span class="n">all_to_keep</span><span class="p">,</span> <span class="n">order</span> <span class="o">=</span> <span class="n">more_steps</span><span class="p">,</span> <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;OUT&#39;</span><span class="p">)</span>
            
            <span class="n">longer_paths</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">n1</span><span class="p">))</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">n2</span><span class="p">))</span>
            
            <span class="n">all_to_keep</span> <span class="o">=</span> <span class="n">all_to_keep</span> <span class="o">|</span> <span class="n">longer_paths</span>
            <span class="n">delete</span> <span class="o">=</span> <span class="n">delete</span> <span class="o">-</span> <span class="n">longer_paths</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">pa</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">delete_vertices</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">delete</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pa</span><span class="o">.</span><span class="n">_directed</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pa</span><span class="o">.</span><span class="n">dgraph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pa</span><span class="o">.</span><span class="n">graph</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pa</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pa</span><span class="o">.</span><span class="n">update_vindex</span><span class="p">()</span>
        
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">:: Nodes: </span><span class="si">%u</span><span class="s1"> -&gt; </span><span class="si">%u</span><span class="s1">, edges: </span><span class="si">%u</span><span class="s1"> -&gt; </span><span class="si">%u</span><span class="se">\n</span><span class="s1">&#39;</span>\
            <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">   Removed </span><span class="si">%u</span><span class="s1"> vertices and </span><span class="si">%u</span><span class="s1"> edges</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">whole</span><span class="o">.</span><span class="n">vcount</span><span class="p">(),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pa</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vcount</span><span class="p">(),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">whole</span><span class="o">.</span><span class="n">ecount</span><span class="p">(),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pa</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">ecount</span><span class="p">(),</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">delete</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">whole</span><span class="o">.</span><span class="n">ecount</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">pa</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">ecount</span><span class="p">()</span>
            <span class="p">))</span></div>
    
<div class="viewcode-block" id="Pex100.sparsen_network"><a class="viewcode-back" href="../../index.html#pex100.Pex100.sparsen_network">[docs]</a>    <span class="k">def</span> <span class="nf">sparsen_network</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">perc</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes a portion of the edges based on certain conditions.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">dens0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pa</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">density</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="s1">&#39;ptm&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pa</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">()</span> <span class="ow">or</span> \
            <span class="nb">max</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pa</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;ptm&#39;</span><span class="p">]))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pa</span><span class="o">.</span><span class="n">load_ptms</span><span class="p">()</span>
        
        <span class="n">assay_ptms</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dKinAssaySub</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
        
        <span class="c1"># edges between kinases and substrates in the assay</span>
        <span class="n">es_protected</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span>
                                        <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;ptm&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="n">assay_ptms</span><span class="p">),</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">pa</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">))</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">pa</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;refxsrc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pa</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;references&#39;</span><span class="p">])))</span> <span class="o">*</span> \
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pa</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;sources&#39;</span><span class="p">]))))</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">pa</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;sign&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span>
                                        <span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">is_stimulation</span><span class="p">()</span> <span class="ow">or</span> \
                                        <span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">is_inhibition</span><span class="p">(),</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">pa</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">))</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">pa</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;nptm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pa</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;ptm&#39;</span><span class="p">]))</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">pa</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;mindeg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="nb">min</span><span class="p">(</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">pa</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">]</span><span class="o">.</span><span class="n">degree</span><span class="p">(),</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">pa</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">degree</span><span class="p">()),</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">pa</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">))</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">pa</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
            <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pa</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;refxsrc&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> \
            <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pa</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;sign&#39;</span><span class="p">],</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> \
            <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pa</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;nptm&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> \
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pa</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;mindeg&#39;</span><span class="p">]))</span>
        
        <span class="n">cutoff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pa</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">]),</span> <span class="n">perc</span><span class="p">)</span>
        
        <span class="n">delete</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
                        <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span>
                            <span class="n">e</span><span class="o">.</span><span class="n">index</span> <span class="ow">in</span> <span class="n">es_protected</span> <span class="ow">or</span> \
                            <span class="n">e</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">cutoff</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">pa</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">))))</span>
        
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pa</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
            <span class="n">this_es</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pa</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">_source</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pa</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">_target</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
            <span class="p">))</span>
            
            <span class="n">eids</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">this_es</span><span class="p">)))</span>
            
            <span class="c1"># if all edges of one node would be removed,</span>
            <span class="c1"># we still keep the one with the highest weight</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">eids</span> <span class="o">-</span> <span class="n">delete</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                
                <span class="n">maxweight</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span>
                                        <span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">],</span> <span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">),</span>
                                    <span class="n">this_es</span><span class="p">),</span>
                                <span class="n">key</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">i</span><span class="p">:</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="mi">1</span><span class="p">]</span>
                
                <span class="k">if</span> <span class="n">maxweight</span> <span class="ow">in</span> <span class="n">delete</span><span class="p">:</span>
                    <span class="n">delete</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">maxweight</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">pa</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">delete_edges</span><span class="p">(</span><span class="n">delete</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pa</span><span class="o">.</span><span class="n">update_vindex</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pa</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">:: Sparsening network: </span><span class="si">%u</span><span class="s1"> edges&#39;</span>\
            <span class="s1">&#39; removed, </span><span class="si">%u</span><span class="s1"> have been kept.</span><span class="se">\n</span><span class="s1">&#39;</span>\
            <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">   Density changed from </span><span class="si">%.04f</span><span class="s1"> to </span><span class="si">%.04f</span><span class="s1">.</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> \
                <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">delete</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">pa</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">ecount</span><span class="p">(),</span>
                 <span class="n">dens0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pa</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">density</span><span class="p">()))</span></div>
    
<div class="viewcode-block" id="Pex100.collect_assay_psites"><a class="viewcode-back" href="../../index.html#pex100.Pex100.collect_assay_psites">[docs]</a>    <span class="k">def</span> <span class="nf">collect_assay_psites</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Collects all phosphosites included in the assay.</span>
<span class="sd">        Result saved to `setAssayPsites` attribute.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">aFc</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">daFcTable</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">setAssayPsites</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psite_from_fc_row</span><span class="p">,</span> <span class="n">aFc</span><span class="p">)))</span></div>
    
<div class="viewcode-block" id="Pex100.collect_participants"><a class="viewcode-back" href="../../index.html#pex100.Pex100.collect_participants">[docs]</a>    <span class="k">def</span> <span class="nf">collect_participants</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                             <span class="n">attr</span><span class="p">,</span>
                             <span class="n">get_participant</span> <span class="o">=</span> <span class="s1">&#39;get_kinase_uniprot&#39;</span><span class="p">,</span>
                             <span class="n">type_filter</span> <span class="o">=</span> <span class="s1">&#39;is_phosphorylation&#39;</span><span class="p">,</span>
                             <span class="n">regenerate</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Collects all kinases from the kinase-substrate interactions</span>
<span class="sd">        loaded from databases. Creates a unique list and saves it to</span>
<span class="sd">        attribute `attr`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">regenerate</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        
        <span class="n">get_participant</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">get_participant</span><span class="p">)</span>
        <span class="n">type_filter</span>     <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">type_filter</span><span class="p">)</span>
        
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span>
            <span class="nb">list</span><span class="p">(</span>
                <span class="nb">set</span><span class="p">(</span>
                    <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span>
                        <span class="o">*</span><span class="nb">map</span><span class="p">(</span>
                            <span class="k">lambda</span> <span class="n">kss</span><span class="p">:</span>
                                <span class="nb">list</span><span class="p">(</span>
                                    <span class="nb">map</span><span class="p">(</span>
                                        <span class="n">get_participant</span><span class="p">,</span>
                                        <span class="nb">filter</span><span class="p">(</span>
                                            <span class="n">type_filter</span><span class="p">,</span>
                                            <span class="n">kss</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                                        <span class="p">)</span>
                                    <span class="p">)</span>
                                <span class="p">),</span>
                            <span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dPhosDb</span><span class="p">)</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span></div>
    
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="Pex100.get_kinase_uniprot"><a class="viewcode-back" href="../../index.html#pex100.Pex100.get_kinase_uniprot">[docs]</a>    <span class="k">def</span> <span class="nf">get_kinase_uniprot</span><span class="p">(</span><span class="n">dommot</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the UniProt of the kinase from a</span>
<span class="sd">        pypath.intera.DomainMotif object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">dommot</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">protein</span></div>
    
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="Pex100.is_phosphorylation"><a class="viewcode-back" href="../../index.html#pex100.Pex100.is_phosphorylation">[docs]</a>    <span class="k">def</span> <span class="nf">is_phosphorylation</span><span class="p">(</span><span class="n">dommot</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns `True` if the type of an enzyme-substrate interaction</span>
<span class="sd">        is `phosphorylation`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">dommot</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;phosphorylation&#39;</span></div>
    
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="Pex100.get_substrate_psite"><a class="viewcode-back" href="../../index.html#pex100.Pex100.get_substrate_psite">[docs]</a>    <span class="k">def</span> <span class="nf">get_substrate_psite</span><span class="p">(</span><span class="n">dommot</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        From a `pypath.intera.DomainMotif` object, gets the identity of</span>
<span class="sd">        the phosphosite in a &#39;UniProt_[residue][number]&#39; format.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_</span><span class="si">%s%u</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">dommot</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">protein</span><span class="p">,</span>
                            <span class="n">dommot</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">residue</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                            <span class="n">dommot</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">residue</span><span class="o">.</span><span class="n">number</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="Pex100.kinase_psite_adj"><a class="viewcode-back" href="../../index.html#pex100.Pex100.kinase_psite_adj">[docs]</a>    <span class="k">def</span> <span class="nf">kinase_psite_adj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">regenerate</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates and adjacency matrix of kinases and target phosphorylation</span>
<span class="sd">        sites, based on database data. The matrix is a `pandas.DataFrame`</span>
<span class="sd">        with values of 1.0 if the kinase phosphorylates the site otherwise</span>
<span class="sd">        `numpy.nan` values. The matrix is saved into the `dfKinPsite`</span>
<span class="sd">        attribute.</span>
<span class="sd">        This method also builds a dictionary of kinase-phosphosite</span>
<span class="sd">        relationships which will be useful later to query the targets</span>
<span class="sd">        of kinases.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="p">(</span>
            <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;dsetKinPsite&#39;</span><span class="p">)</span> <span class="ow">and</span>
            <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;dsetKinAllPsite&#39;</span><span class="p">)</span> <span class="ow">and</span>
            <span class="ow">not</span> <span class="n">regenerate</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">collect_participants</span><span class="p">(</span><span class="s1">&#39;lAllKinases&#39;</span><span class="p">,</span> <span class="n">regenerate</span> <span class="o">=</span> <span class="n">regenerate</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collect_participants</span><span class="p">(</span><span class="s1">&#39;lAllPsites&#39;</span><span class="p">,</span> <span class="s1">&#39;get_substrate_psite&#39;</span><span class="p">,</span>
                                  <span class="n">regenerate</span> <span class="o">=</span> <span class="n">regenerate</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">dsetKinPsite</span>    <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dsetKinAllPsite</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="n">nkin</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lAllKinases</span><span class="p">)</span>
        <span class="n">npst</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lAllPsites</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">dfKinPsite</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">shape</span> <span class="o">=</span> <span class="p">[</span><span class="n">npst</span><span class="p">,</span> <span class="n">nkin</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dfKinPsite</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dfKinPsite</span>    <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dfKinPsite</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dfKinPsite</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lAllKinases</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dfKinPsite</span><span class="o">.</span><span class="n">index</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lAllPsites</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">collect_assay_psites</span><span class="p">()</span>
        
        <span class="k">for</span> <span class="n">sub</span><span class="p">,</span> <span class="n">kss</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dPhosDb</span><span class="p">):</span>
            
            <span class="k">for</span> <span class="n">ks</span> <span class="ow">in</span> <span class="n">kss</span><span class="p">:</span>
                
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_phosphorylation</span><span class="p">(</span><span class="n">ks</span><span class="p">):</span>
                    
                    <span class="n">kin</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_kinase_uniprot</span><span class="p">(</span><span class="n">ks</span><span class="p">)</span>
                    <span class="n">psite</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_substrate_psite</span><span class="p">(</span><span class="n">ks</span><span class="p">)</span>
                    
                    <span class="k">if</span> <span class="n">kin</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dsetKinPsite</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">dsetKinPsite</span><span class="p">[</span><span class="n">kin</span><span class="p">]</span>    <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">dsetKinAllPsite</span><span class="p">[</span><span class="n">kin</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
                    
                    <span class="bp">self</span><span class="o">.</span><span class="n">dfKinPsite</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">psite</span><span class="p">,</span> <span class="n">kin</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
                    
                    <span class="bp">self</span><span class="o">.</span><span class="n">dsetKinAllPsite</span><span class="p">[</span><span class="n">kin</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">psite</span><span class="p">)</span>
                    
                    <span class="k">if</span> <span class="n">psite</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">setAssayPsites</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">dsetKinPsite</span><span class="p">[</span><span class="n">kin</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">psite</span><span class="p">)</span></div>
    
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="Pex100.psite_from_fc_row"><a class="viewcode-back" href="../../index.html#pex100.Pex100.psite_from_fc_row">[docs]</a>    <span class="k">def</span> <span class="nf">psite_from_fc_row</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns phosphosite string representation from a row of and FC array.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_</span><span class="si">%s%u</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span></div>
    
<div class="viewcode-block" id="Pex100.fc_data_frames"><a class="viewcode-back" href="../../index.html#pex100.Pex100.fc_data_frames">[docs]</a>    <span class="k">def</span> <span class="nf">fc_data_frames</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">std</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">colname</span> <span class="o">=</span> <span class="s1">&#39;30min&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a `pandas.DataFrame` to serve as input for `kinact`.</span>
<span class="sd">        Data frame contains phosphorylation sites and their fold changes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">ddfFcData</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="k">for</span> <span class="n">treatment</span><span class="p">,</span> <span class="n">fctab</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">daFcTable</span><span class="p">[</span><span class="n">std</span><span class="p">]):</span>
            
            <span class="n">psites</span><span class="p">,</span> <span class="n">fc</span> <span class="o">=</span> \
                <span class="nb">zip</span><span class="p">(</span>
                    <span class="o">*</span><span class="nb">map</span><span class="p">(</span>
                        <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span>
                            <span class="p">(</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">psite_from_fc_row</span><span class="p">(</span><span class="n">row</span><span class="p">),</span> <span class="c1"># psite</span>
                                <span class="n">row</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="c1"># fold change</span>
                            <span class="p">),</span>
                        <span class="n">fctab</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">ddfFcData</span><span class="p">[</span><span class="n">treatment</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">fc</span><span class="p">),</span>
                                                     <span class="n">index</span> <span class="o">=</span> <span class="n">psites</span><span class="p">,</span>
                                                     <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">colname</span><span class="p">])</span></div>
    
<div class="viewcode-block" id="Pex100.kinact_analysis"><a class="viewcode-back" href="../../index.html#pex100.Pex100.kinact_analysis">[docs]</a>    <span class="k">def</span> <span class="nf">kinact_analysis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">std</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets up and runs kinase activity analysis with `kinact`.</span>
<span class="sd">        Results saved to the `dddfKinactResult` attribute.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">dddfKseaResult</span>      <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dddfNetworkinResult</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="c1"># collecting UniProts of all kinases</span>
        <span class="c1"># and identities of all psites</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collect_participants</span><span class="p">(</span><span class="s1">&#39;lAllKinases&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collect_participants</span><span class="p">(</span><span class="s1">&#39;lAllPsites&#39;</span><span class="p">,</span> <span class="s1">&#39;get_substrate_psite&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kinase_psite_adj</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fc_data_frames</span><span class="p">(</span><span class="n">std</span> <span class="o">=</span> <span class="n">std</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">tr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">daFcTable</span><span class="p">[</span><span class="n">std</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">dddfKseaResult</span><span class="p">[</span><span class="n">tr</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dddfNetworkinResult</span><span class="p">[</span><span class="n">tr</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">dddfKseaResult</span><span class="p">[</span><span class="n">tr</span><span class="p">][</span><span class="s1">&#39;score&#39;</span><span class="p">],</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">dddfKseaResult</span><span class="p">[</span><span class="n">tr</span><span class="p">][</span><span class="s1">&#39;pval&#39;</span><span class="p">]</span> <span class="o">=</span> \
                                              \
                <span class="n">kinact</span><span class="o">.</span><span class="n">ksea</span><span class="o">.</span><span class="n">ksea_mean</span><span class="p">(</span>
                    <span class="n">data_fc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ddfFcData</span><span class="p">[</span><span class="n">tr</span><span class="p">][</span><span class="s1">&#39;30min&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">(),</span>
                    <span class="n">interactions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dfKinPsite</span><span class="p">,</span>
                    <span class="n">mP</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ddfFcData</span><span class="p">[</span><span class="n">tr</span><span class="p">][</span><span class="s1">&#39;30min&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
                    <span class="n">delta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ddfFcData</span><span class="p">[</span><span class="n">tr</span><span class="p">][</span><span class="s1">&#39;30min&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">std</span><span class="p">())</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">dddfNetworkinResult</span><span class="p">[</span><span class="n">tr</span><span class="p">][</span><span class="s1">&#39;score&#39;</span><span class="p">],</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">dddfNetworkinResult</span><span class="p">[</span><span class="n">tr</span><span class="p">][</span><span class="s1">&#39;pval&#39;</span><span class="p">]</span> <span class="o">=</span> \
                                                   \
                <span class="n">kinact</span><span class="o">.</span><span class="n">networkin</span><span class="o">.</span><span class="n">weighted_mean</span><span class="p">(</span>
                    <span class="n">data_fc</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ddfFcData</span><span class="p">[</span><span class="n">tr</span><span class="p">][</span><span class="s1">&#39;30min&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">(),</span>
                    <span class="n">interactions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dfKinPsite</span><span class="p">,</span>
                    <span class="n">mP</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ddfFcData</span><span class="p">[</span><span class="n">tr</span><span class="p">][</span><span class="s1">&#39;30min&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
                    <span class="n">delta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ddfFcData</span><span class="p">[</span><span class="n">tr</span><span class="p">][</span><span class="s1">&#39;30min&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">std</span><span class="p">())</span></div>
    
<div class="viewcode-block" id="Pex100.targets_of_kinase"><a class="viewcode-back" href="../../index.html#pex100.Pex100.targets_of_kinase">[docs]</a>    <span class="k">def</span> <span class="nf">targets_of_kinase</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kinase_uniprot</span><span class="p">,</span> <span class="n">on_assay</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">uniprots</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a set of one kinase&#39;s targets.</span>
<span class="sd">        </span>
<span class="sd">        :param str kinase_uniprot: The UniProt ID of the kinase.</span>
<span class="sd">        :param bool on_assay: Return the targets only on the assay,</span>
<span class="sd">                              or all from the databases.</span>
<span class="sd">        :param bool uniprots: Return UniProts, or GeneSymbols otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">dsetKinPsite</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dsetKinPsite</span> <span class="k">if</span> <span class="n">on_assay</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">dsetKinPsite</span>
        
        <span class="n">setSubUniprots</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">ps</span><span class="p">:</span> <span class="n">ps</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                                 <span class="n">dsetKinPsite</span><span class="p">[</span><span class="n">kinase_uniprot</span><span class="p">]))</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">uniprots</span><span class="p">:</span>
            
            <span class="k">return</span> \
                <span class="nb">set</span><span class="p">(</span>
                    <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span>
                        <span class="o">*</span><span class="nb">map</span><span class="p">(</span>
                            <span class="k">lambda</span> <span class="n">u</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">pa</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">u</span><span class="p">,</span>
                                                        <span class="s1">&#39;uniprot&#39;</span><span class="p">,</span>
                                                        <span class="s1">&#39;genesymbol&#39;</span><span class="p">,</span>
                                                        <span class="bp">self</span><span class="o">.</span><span class="n">ncbi_tax_id</span><span class="p">),</span>
                            <span class="n">setSubUniprots</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                <span class="p">)</span>
        
        <span class="k">return</span> <span class="n">setSubUniprots</span></div>
    
<div class="viewcode-block" id="Pex100.psite_kinase_adj"><a class="viewcode-back" href="../../index.html#pex100.Pex100.psite_kinase_adj">[docs]</a>    <span class="k">def</span> <span class="nf">psite_kinase_adj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">regenerate</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a dict between psites and kinases.</span>
<span class="sd">        This is for the opposite way lookup as `dsetKinPsite`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;dsetPsiteKin&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">regenerate</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">collect_participants</span><span class="p">(</span><span class="s1">&#39;lAllKinases&#39;</span><span class="p">,</span> <span class="n">regenerate</span> <span class="o">=</span> <span class="n">regenerate</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collect_participants</span><span class="p">(</span><span class="s1">&#39;lAllPsites&#39;</span><span class="p">,</span> <span class="s1">&#39;get_substrate_psite&#39;</span><span class="p">,</span>
                                  <span class="n">regenerate</span> <span class="o">=</span> <span class="n">regenerate</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">dsetPsiteKin</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="k">for</span> <span class="n">kinase</span><span class="p">,</span> <span class="n">psites</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dsetKinPsite</span><span class="p">):</span>
            
            <span class="k">for</span> <span class="n">psite</span> <span class="ow">in</span> <span class="n">psites</span><span class="p">:</span>
                
                <span class="n">tPsite</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_psite</span><span class="p">(</span><span class="n">psite</span><span class="p">)</span>
                
                <span class="k">if</span> <span class="n">tPsite</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dsetPsiteKin</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dsetPsiteKin</span><span class="p">[</span><span class="n">tPsite</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
                
                <span class="bp">self</span><span class="o">.</span><span class="n">dsetPsiteKin</span><span class="p">[</span><span class="n">tPsite</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">kinase</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="Pex100.get_psite"><a class="viewcode-back" href="../../index.html#pex100.Pex100.get_psite">[docs]</a>    <span class="k">def</span> <span class="nf">get_psite</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">substrate</span><span class="p">,</span> <span class="n">residue</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">offset</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        From a phosphosite string representation or substrate UniProt ID,</span>
<span class="sd">        residue name and number separately, returns an uniform tuple</span>
<span class="sd">        representation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">residue</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">offset</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mPsite</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rePsite</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">substrate</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">mPsite</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">:: Could not determine residue and number.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="n">substrate</span><span class="p">,</span> <span class="n">residue</span><span class="p">,</span> <span class="n">offset</span> <span class="o">=</span> <span class="n">mPsite</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
        
        <span class="k">return</span> <span class="p">(</span><span class="n">substrate</span><span class="p">,</span> <span class="n">residue</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">offset</span><span class="p">))</span></div>
    
<div class="viewcode-block" id="Pex100.kinases_of_substrate"><a class="viewcode-back" href="../../index.html#pex100.Pex100.kinases_of_substrate">[docs]</a>    <span class="k">def</span> <span class="nf">kinases_of_substrate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">substrate</span><span class="p">,</span> <span class="n">residue</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">offset</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the kinases of a substrate.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">psite_kinase_adj</span><span class="p">()</span>
        
        <span class="n">psite</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_psite</span><span class="p">(</span><span class="n">substrate</span><span class="p">,</span> <span class="n">residue</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dsetPsiteKin</span><span class="p">[</span><span class="n">psite</span><span class="p">]</span> <span class="k">if</span> <span class="n">psite</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dsetPsiteKin</span> <span class="k">else</span> <span class="nb">set</span><span class="p">([])</span></div>
    
<div class="viewcode-block" id="Pex100.regulatory_sites"><a class="viewcode-back" href="../../index.html#pex100.Pex100.regulatory_sites">[docs]</a>    <span class="k">def</span> <span class="nf">regulatory_sites</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_reload</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads the PhosphoSitePlus regulatory sites data.</span>
<span class="sd">        Data about the phosphorylation sites on the assay</span>
<span class="sd">        is saved to `ddRegSites`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;ddRegSites&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">_reload</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">kinase_psite_adj</span><span class="p">()</span>
        
        <span class="n">raw</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">pypath</span><span class="o">.</span><span class="n">dataio</span><span class="o">.</span><span class="n">regsites_one_organism</span><span class="p">(</span><span class="n">organism</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ncbi_tax_id</span><span class="p">)</span>
        <span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">ddRegSites</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="k">for</span> <span class="n">psite</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">setAssayPsites</span><span class="p">:</span>
            
            <span class="n">tPsite</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_psite</span><span class="p">(</span><span class="n">psite</span><span class="p">)</span>
            <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">tPsite</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">tPsite</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="s1">&#39;phosphorylation&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ddRegSites</span><span class="p">[</span><span class="n">tPsite</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            
            <span class="k">if</span> <span class="n">tPsite</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">raw</span><span class="p">:</span>
                
                <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">tPsite</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">tPsite</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="s1">&#39;phosphorylation&#39;</span><span class="p">)</span>
                
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">raw</span><span class="p">[</span><span class="n">tPsite</span><span class="p">[</span><span class="mi">0</span><span class="p">]]:</span>
                    
                    <span class="bp">self</span><span class="o">.</span><span class="n">ddRegSites</span><span class="p">[</span><span class="n">tPsite</span><span class="p">]</span> <span class="o">=</span> <span class="n">raw</span><span class="p">[</span><span class="n">tPsite</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">key</span><span class="p">]</span></div>
    
<div class="viewcode-block" id="Pex100.get_regulation_data"><a class="viewcode-back" href="../../index.html#pex100.Pex100.get_regulation_data">[docs]</a>    <span class="k">def</span> <span class="nf">get_regulation_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">substrate</span><span class="p">,</span>
                            <span class="n">residue</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">offset</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a piece of information from the regulatory sites</span>
<span class="sd">        data about one phosphorylation site.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">regulatory_sites</span><span class="p">()</span>
        
        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;induces&#39;</span><span class="p">:</span>  <span class="nb">set</span><span class="p">([]),</span>
            <span class="s1">&#39;disrupts&#39;</span><span class="p">:</span> <span class="nb">set</span><span class="p">([]),</span>
            <span class="s1">&#39;positive&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s1">&#39;negative&#39;</span><span class="p">:</span> <span class="kc">False</span>
        <span class="p">}</span>
        
        <span class="n">psite</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_psite</span><span class="p">(</span><span class="n">substrate</span><span class="p">,</span> <span class="n">residue</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ddRegSites</span><span class="p">[</span><span class="n">psite</span><span class="p">][</span><span class="n">key</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">psite</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ddRegSites</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">ddRegSites</span><span class="p">[</span><span class="n">psite</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="k">else</span> <span class="n">defaults</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="p">)</span></div>
    
<div class="viewcode-block" id="Pex100.induced_by"><a class="viewcode-back" href="../../index.html#pex100.Pex100.induced_by">[docs]</a>    <span class="k">def</span> <span class="nf">induced_by</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">substrate</span><span class="p">,</span> <span class="n">residue</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">offset</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the UniProt IDs of the interacting protein partners of the</span>
<span class="sd">        phosphorylated substrate which the phosphorylation event induces</span>
<span class="sd">        the substrate&#39;s interaction with.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_regulation_data</span><span class="p">(</span><span class="s1">&#39;induces&#39;</span><span class="p">,</span> <span class="n">substrate</span><span class="p">,</span>
                                        <span class="n">residue</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="Pex100.disrupted_by"><a class="viewcode-back" href="../../index.html#pex100.Pex100.disrupted_by">[docs]</a>    <span class="k">def</span> <span class="nf">disrupted_by</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">substrate</span><span class="p">,</span> <span class="n">residue</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">offset</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the UniProt IDs of the interacting protein partners of the</span>
<span class="sd">        phosphorylated substrate which the phosphorylation event disrupts</span>
<span class="sd">        the substrate&#39;s interaction with.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_regulation_data</span><span class="p">(</span><span class="s1">&#39;disrupts&#39;</span><span class="p">,</span> <span class="n">substrate</span><span class="p">,</span>
                                        <span class="n">residue</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="Pex100.affected_by"><a class="viewcode-back" href="../../index.html#pex100.Pex100.affected_by">[docs]</a>    <span class="k">def</span> <span class="nf">affected_by</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">substrate</span><span class="p">,</span> <span class="n">residue</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">offset</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the UniProt IDs of the interacting protein partners of the</span>
<span class="sd">        phosphorylated substrate which the phosphorylation event affects</span>
<span class="sd">        the substrate&#39;s interaction with.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">return</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_regulation_data</span><span class="p">(</span><span class="s1">&#39;induces&#39;</span><span class="p">,</span> <span class="n">substrate</span><span class="p">,</span>
                                        <span class="n">residue</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span> <span class="o">|</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_regulation_data</span><span class="p">(</span><span class="s1">&#39;disrupts&#39;</span><span class="p">,</span> <span class="n">substrate</span><span class="p">,</span>
                                        <span class="n">residue</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>
        <span class="p">)</span></div>
    
<div class="viewcode-block" id="Pex100.psite_effect"><a class="viewcode-back" href="../../index.html#pex100.Pex100.psite_effect">[docs]</a>    <span class="k">def</span> <span class="nf">psite_effect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">substrate</span><span class="p">,</span> <span class="n">residue</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">offset</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a tuple of two boolean values.</span>
<span class="sd">        The first is True if the phosphorylation event has a</span>
<span class="sd">        stimulatory effect. The second is True if the phosphorylation</span>
<span class="sd">        has an inhibitory effect.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_regulation_data</span><span class="p">(</span><span class="s1">&#39;positive&#39;</span><span class="p">,</span> <span class="n">substrate</span><span class="p">,</span> <span class="n">residue</span><span class="p">,</span> <span class="n">offset</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_regulation_data</span><span class="p">(</span><span class="s1">&#39;negative&#39;</span><span class="p">,</span> <span class="n">substrate</span><span class="p">,</span> <span class="n">residue</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>
        <span class="p">)</span></div>
    
<div class="viewcode-block" id="Pex100.effect_as_int"><a class="viewcode-back" href="../../index.html#pex100.Pex100.effect_as_int">[docs]</a>    <span class="k">def</span> <span class="nf">effect_as_int</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">substrate</span><span class="p">,</span> <span class="n">residue</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">offset</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the unambiguous effect as an integer, either -1, 0 or 1.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="mi">0</span> <span class="o">+</span>
            <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psite_stimulatory_unambiguous</span><span class="p">(</span>
                <span class="n">substrate</span><span class="p">,</span> <span class="n">residue</span><span class="p">,</span> <span class="n">offset</span><span class="p">))</span> <span class="o">-</span>
            <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psite_inhibitory_unambiguous</span><span class="p">(</span>
                <span class="n">substrate</span><span class="p">,</span> <span class="n">residue</span><span class="p">,</span> <span class="n">offset</span><span class="p">))</span>
        <span class="p">)</span></div>
    
<div class="viewcode-block" id="Pex100.psite_stimulatory_unambiguous"><a class="viewcode-back" href="../../index.html#pex100.Pex100.psite_stimulatory_unambiguous">[docs]</a>    <span class="k">def</span> <span class="nf">psite_stimulatory_unambiguous</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">substrate</span><span class="p">,</span>
                                      <span class="n">residue</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">offset</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns True only if the phosphorylation site is stimulatory</span>
<span class="sd">        and not inhibitory.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">effect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">psite_effect</span><span class="p">(</span><span class="n">substrate</span><span class="p">,</span> <span class="n">residue</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">effect</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">effect</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span></div>
    
<div class="viewcode-block" id="Pex100.psite_inhibitory_unambiguous"><a class="viewcode-back" href="../../index.html#pex100.Pex100.psite_inhibitory_unambiguous">[docs]</a>    <span class="k">def</span> <span class="nf">psite_inhibitory_unambiguous</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">substrate</span><span class="p">,</span>
                                     <span class="n">residue</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">offset</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns True only if the phosphorylation site is inhibitory</span>
<span class="sd">        and not stimulatory.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">effect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">psite_effect</span><span class="p">(</span><span class="n">substrate</span><span class="p">,</span> <span class="n">residue</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">effect</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">effect</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div>
    
<div class="viewcode-block" id="Pex100.psite_stimulatory"><a class="viewcode-back" href="../../index.html#pex100.Pex100.psite_stimulatory">[docs]</a>    <span class="k">def</span> <span class="nf">psite_stimulatory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">substrate</span><span class="p">,</span> <span class="n">residue</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">offset</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tells if the phosphorylation site has a stimulatory effect.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_regulation_data</span><span class="p">(</span><span class="s1">&#39;positive&#39;</span><span class="p">,</span> <span class="n">substrate</span><span class="p">,</span>
                                        <span class="n">residue</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="Pex100.psite_inhibitory"><a class="viewcode-back" href="../../index.html#pex100.Pex100.psite_inhibitory">[docs]</a>    <span class="k">def</span> <span class="nf">psite_inhibitory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">substrate</span><span class="p">,</span> <span class="n">residue</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">offset</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tells if the phosphorylation site has a inhibitory effect.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_regulation_data</span><span class="p">(</span><span class="s1">&#39;negative&#39;</span><span class="p">,</span> <span class="n">substrate</span><span class="p">,</span>
                                        <span class="n">residue</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="Pex100.kinact_top"><a class="viewcode-back" href="../../index.html#pex100.Pex100.kinact_top">[docs]</a>    <span class="k">def</span> <span class="nf">kinact_top</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">threshold</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prints a table with top results from `kinact`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">fp</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="k">if</span> <span class="n">fname</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
        
        <span class="n">cwidth</span> <span class="o">=</span> <span class="mi">10</span>
        
        <span class="n">empty</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="n">cwidth</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">rule</span>  <span class="o">=</span> <span class="s1">&#39;=&#39;</span> <span class="o">*</span> <span class="p">(</span><span class="n">cwidth</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
        
        <span class="k">def</span> <span class="nf">cell</span><span class="p">(</span><span class="n">content</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="s1">&#39;ljust&#39;</span><span class="p">):</span>
                <span class="k">return</span> <span class="s1">&#39; </span><span class="si">%s</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="n">content</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="n">cwidth</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">content</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;float&#39;</span><span class="p">:</span>
                <span class="n">content</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%.05f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">content</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">content</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
                <span class="n">content</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%u</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">content</span>
            <span class="k">return</span> <span class="s1">&#39; </span><span class="si">%s</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="n">content</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="n">cwidth</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">meth</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Ksea&#39;</span><span class="p">,</span> <span class="s1">&#39;Networkin&#39;</span><span class="p">]:</span>
            
            <span class="n">result</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;dddf</span><span class="si">%s</span><span class="s1">Result&#39;</span> <span class="o">%</span> <span class="n">meth</span><span class="p">)</span>
            
            <span class="n">numtr</span>  <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            
            <span class="c1"># header</span>
            <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">rule</span> <span class="o">*</span> <span class="n">numtr</span> <span class="o">*</span> <span class="mi">3</span><span class="p">))</span>
            <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">meth</span><span class="p">)</span>
            <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">rule</span> <span class="o">*</span> <span class="n">numtr</span> <span class="o">*</span> <span class="mi">3</span><span class="p">))</span>
            <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span>
                <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="nb">list</span><span class="p">(</span>
                        <span class="nb">map</span><span class="p">(</span>
                            <span class="k">lambda</span> <span class="n">tr</span><span class="p">:</span>
                                <span class="s1">&#39;</span><span class="si">%s%s%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                                    <span class="n">cell</span><span class="p">(</span><span class="n">tr</span><span class="p">),</span> <span class="n">cell</span><span class="p">(</span><span class="n">empty</span><span class="p">),</span> <span class="n">cell</span><span class="p">(</span><span class="n">empty</span><span class="p">)</span>
                                <span class="p">),</span>
                            <span class="nb">sorted</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">rule</span> <span class="o">*</span> <span class="n">numtr</span> <span class="o">*</span> <span class="mi">3</span><span class="p">))</span>
            <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span>
                <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
                    <span class="s1">&#39;</span><span class="si">%s%s%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="n">cell</span><span class="p">(</span><span class="s1">&#39;Protein&#39;</span><span class="p">),</span>
                        <span class="n">cell</span><span class="p">(</span><span class="s1">&#39;Score&#39;</span><span class="p">),</span>
                        <span class="n">cell</span><span class="p">(</span><span class="s1">&#39;p-value&#39;</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="p">]</span> <span class="o">*</span> <span class="n">numtr</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">rule</span> <span class="o">*</span> <span class="n">numtr</span> <span class="o">*</span> <span class="mi">3</span><span class="p">))</span>
            
            <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
            
            <span class="k">for</span> <span class="n">tr</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                
                <span class="n">res</span>  <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="n">tr</span><span class="p">]</span>
                <span class="n">ordr</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="s1">&#39;pval&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">argsort</span><span class="p">()</span>
                
                <span class="n">data</span><span class="p">[</span><span class="n">tr</span><span class="p">]</span> <span class="o">=</span> \
                    <span class="nb">list</span><span class="p">(</span>
                        <span class="nb">map</span><span class="p">(</span>
                            <span class="k">lambda</span> <span class="n">i</span><span class="p">:</span>
                                <span class="p">(</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">pa</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span>
                                        <span class="n">res</span><span class="p">[</span><span class="s1">&#39;pval&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                        <span class="s1">&#39;uniprot&#39;</span><span class="p">,</span>
                                        <span class="s1">&#39;genesymbol&#39;</span><span class="p">,</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">ncbi_tax_id</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                                    <span class="n">res</span><span class="p">[</span><span class="s1">&#39;score&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                                    <span class="n">res</span><span class="p">[</span><span class="s1">&#39;pval&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                                <span class="p">),</span>
                            <span class="nb">filter</span><span class="p">(</span>
                                <span class="k">lambda</span> <span class="n">i</span><span class="p">:</span>
                                    <span class="n">res</span><span class="p">[</span><span class="s1">&#39;pval&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">threshold</span><span class="p">,</span>
                                <span class="n">ordr</span>
                            <span class="p">)</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
            
            <span class="n">nrows</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
            
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="n">nrows</span><span class="p">):</span>
                
                <span class="k">for</span> <span class="n">tr</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                    
                    <span class="n">dat</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">tr</span><span class="p">]</span>
                    
                    <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">dat</span><span class="p">):</span>
                        
                        <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s%s%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">dat</span><span class="p">[</span><span class="n">i</span><span class="p">])))</span>
                    
                    <span class="k">else</span><span class="p">:</span>
                        
                        <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">empty</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span>
                
                <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            
            <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">rule</span> <span class="o">*</span> <span class="n">numtr</span> <span class="o">*</span> <span class="mi">3</span><span class="p">))</span>
        
        <span class="k">if</span> <span class="n">fname</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            
            <span class="n">fp</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>
    
<div class="viewcode-block" id="Pex100.fc_diff_table"><a class="viewcode-back" href="../../index.html#pex100.Pex100.fc_diff_table">[docs]</a>    <span class="k">def</span> <span class="nf">fc_diff_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Orders proteins by fold change diff.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;daFcTable&#39;</span><span class="p">,</span> <span class="s1">&#39;daUniqueFcTable&#39;</span><span class="p">]:</span>
            
            <span class="n">tables</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
            
            <span class="k">for</span> <span class="n">std</span> <span class="ow">in</span> <span class="n">tables</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                
                <span class="n">tab</span> <span class="o">=</span> <span class="n">tables</span><span class="p">[</span><span class="n">std</span><span class="p">]</span>
                
                <span class="n">ordr</span> <span class="o">=</span> \
                    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                        <span class="nb">list</span><span class="p">(</span>
                            <span class="nb">map</span><span class="p">(</span>
                                <span class="k">lambda</span> <span class="n">it</span><span class="p">:</span>
                                    <span class="n">it</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                <span class="nb">sorted</span><span class="p">(</span>
                                    <span class="nb">map</span><span class="p">(</span>
                                        <span class="k">lambda</span> <span class="n">i</span><span class="p">:</span>
                                            <span class="p">(</span>
                                                <span class="n">i</span><span class="p">,</span>
                                                <span class="nb">max</span><span class="p">(</span>
                                                    <span class="nb">map</span><span class="p">(</span>
                                                        <span class="k">lambda</span> <span class="n">tr</span><span class="p">:</span>
                                                            <span class="nb">abs</span><span class="p">(</span>
                                                                <span class="n">tab</span><span class="p">[</span><span class="n">tr</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">i</span><span class="p">,</span><span class="mi">8</span><span class="p">]</span><span class="o">-</span>
                                                                <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span>
                                                                    <span class="n">tab</span><span class="p">[</span><span class="n">tr</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">i</span><span class="p">,</span><span class="mi">8</span><span class="p">]</span>
                                                                <span class="p">)</span> <span class="o">-</span> <span class="p">(</span>
                                                                <span class="n">tab</span><span class="p">[</span><span class="n">tr</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="n">i</span><span class="p">,</span><span class="mi">8</span><span class="p">]</span> <span class="o">-</span>
                                                                <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span>
                                                                    <span class="n">tab</span><span class="p">[</span><span class="n">tr</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="n">i</span><span class="p">,</span><span class="mi">8</span><span class="p">]</span>
                                                                <span class="p">)</span>
                                                                <span class="p">)</span>
                                                            <span class="p">),</span>
                                                        <span class="n">itertools</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span>
                                                            <span class="n">tab</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span>
                                                            <span class="mi">2</span>
                                                        <span class="p">)</span>
                                                    <span class="p">)</span>
                                                <span class="p">)</span>
                                            <span class="p">),</span>
                                        <span class="n">xrange</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">tab</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                                    <span class="p">),</span>
                                    <span class="n">key</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">it</span><span class="p">:</span> <span class="n">it</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                    <span class="n">reverse</span> <span class="o">=</span> <span class="kc">True</span>
                                <span class="p">)</span>
                            <span class="p">)</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                
                <span class="k">for</span> <span class="n">tr</span> <span class="ow">in</span> <span class="n">tab</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    
                    <span class="n">tab</span><span class="p">[</span><span class="n">tr</span><span class="p">]</span> <span class="o">=</span> <span class="n">tab</span><span class="p">[</span><span class="n">tr</span><span class="p">][</span><span class="n">ordr</span><span class="p">,:]</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">fc_table_to_file</span><span class="p">(</span><span class="n">unique_antibodies</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fc_table_to_file</span><span class="p">(</span><span class="n">unique_antibodies</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="Pex100.fc_top_table"><a class="viewcode-back" href="../../index.html#pex100.Pex100.fc_top_table">[docs]</a>    <span class="k">def</span> <span class="nf">fc_top_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unique</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes FC values sorted by maximum difference into file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">lHdr</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;uniprot&#39;</span><span class="p">,</span> <span class="s1">&#39;genesymbol&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span>
                <span class="s1">&#39;resaa&#39;</span><span class="p">,</span> <span class="s1">&#39;resnum&#39;</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">,</span>
                <span class="s1">&#39;original_resnum&#39;</span><span class="p">,</span> <span class="s1">&#39;effect&#39;</span><span class="p">,</span> <span class="s1">&#39;psite&#39;</span><span class="p">]</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">daFcTop</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">fc_diff_table</span><span class="p">()</span>
        
        <span class="n">fctab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">daUniqueFcTable</span> <span class="k">if</span> <span class="n">unique</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">daFcTable</span>
        <span class="n">trs</span>   <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">fctab</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        
        <span class="n">lHdr</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">trs</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">std</span><span class="p">,</span> <span class="n">da</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">fctab</span><span class="p">):</span>
            
            <span class="n">ll</span> <span class="o">=</span> <span class="p">[]</span>
            
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">da</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                
                <span class="n">row</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">da</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">,:</span><span class="mi">8</span><span class="p">])</span>
                <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_</span><span class="si">%s%u</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="mi">4</span><span class="p">]))</span>
                
                <span class="k">for</span> <span class="n">tr</span> <span class="ow">in</span> <span class="n">trs</span><span class="p">:</span>
                    
                    <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">da</span><span class="p">[</span><span class="n">tr</span><span class="p">][</span><span class="n">i</span><span class="p">,</span><span class="mi">9</span><span class="p">])</span>
                
                <span class="n">ll</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">daFcTop</span><span class="p">[</span><span class="n">std</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ll</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">object</span><span class="p">)</span>
            
            <span class="n">fname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fnFcTopCommon</span> <span class="o">%</span> <span class="n">std</span>
            
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">:: Writing to `</span><span class="si">%s</span><span class="s1">`.</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">fname</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">table_to_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">daFcTop</span><span class="p">[</span><span class="n">std</span><span class="p">],</span> <span class="n">fname</span><span class="p">,</span> <span class="n">lHdr</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="Pex100.top_fc_venn"><a class="viewcode-back" href="../../index.html#pex100.Pex100.top_fc_venn">[docs]</a>    <span class="k">def</span> <span class="nf">top_fc_venn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threshold</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
                    <span class="n">sign</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                    <span class="n">number_labels</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                    <span class="n">figsize</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span>
                    <span class="n">adj</span> <span class="o">=</span> <span class="p">{},</span>
                    <span class="n">treatments</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;BMP8b&#39;</span><span class="p">,</span> <span class="s1">&#39;BMP8b_NE&#39;</span><span class="p">,</span> <span class="s1">&#39;NE&#39;</span><span class="p">],</span>
                    <span class="n">label_size</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a Venn diagram of the highest FCs by treatments.</span>
<span class="sd">        </span>
<span class="sd">        :param str,None sign: If None (default) effect signs are not</span>
<span class="sd">                              considered. If `positive`, only stimulated</span>
<span class="sd">                              if `negative` only inhibited sites used.</span>
<span class="sd">        :param bool number_labels: If `True`, number of elements plotted</span>
<span class="sd">                                   in each field of the diagram; otherwise</span>
<span class="sd">                                   a list of protein names.</span>
<span class="sd">        :param str title: The main title of the plot.</span>
<span class="sd">        :param float threshold: The threshold for log2 fold change.</span>
<span class="sd">                                Fold changes with lower absolute value are</span>
<span class="sd">                                not considered.</span>
<span class="sd">        :param list figsize: Figure size for matplotlib.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">def</span> <span class="nf">set_label_text</span><span class="p">(</span><span class="n">elements</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">field_id</span><span class="p">,</span>
                           <span class="n">number</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">_adj</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)):</span>
            
            <span class="k">if</span> <span class="n">number</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%u</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">elements</span><span class="p">))</span>
            
            <span class="n">label</span> <span class="o">=</span> <span class="n">plot</span><span class="p">[</span><span class="s1">&#39;venn&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_label_by_id</span><span class="p">(</span><span class="n">field_id</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                
                <span class="n">label</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
                <span class="n">label</span><span class="o">.</span><span class="n">set_wrap</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">label</span><span class="o">.</span><span class="n">set_bbox</span><span class="p">({</span>
                    <span class="s1">&#39;facecolor&#39;</span><span class="p">:</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;edgecolor&#39;</span><span class="p">:</span> <span class="n">color</span><span class="p">,</span>
                    <span class="s1">&#39;boxstyle&#39;</span><span class="p">:</span> <span class="s1">&#39;round,pad=1&#39;</span>
                <span class="p">})</span>
                <span class="n">pos</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span>
                <span class="n">label</span><span class="o">.</span><span class="n">set_position</span><span class="p">((</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">_adj</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                    <span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">_adj</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                <span class="k">if</span> <span class="n">label_size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">label</span><span class="o">.</span><span class="n">set_size</span><span class="p">(</span><span class="n">label_size</span><span class="p">)</span>
                
                <span class="n">label_artists</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
        
        <span class="k">def</span> <span class="nf">get_adj</span><span class="p">(</span><span class="n">setkey</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">adj</span><span class="p">[</span><span class="n">setkey</span><span class="p">]</span> <span class="k">if</span> <span class="n">setkey</span> <span class="ow">in</span> <span class="n">adj</span> <span class="k">else</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
        
        <span class="n">treatments</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">treatments</span><span class="p">)</span>
        <span class="n">label_artists</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;plotVenn&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plotVenn</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;nosign&#39;</span> <span class="k">if</span> <span class="n">sign</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">sign</span><span class="p">,</span>
               <span class="s1">&#39;</span><span class="si">%.02f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">threshold</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dsetTopFc</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">plot</span>  <span class="o">=</span> <span class="p">{}</span>
        <span class="n">plot</span><span class="p">[</span><span class="s1">&#39;fname&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fnVennPlot</span> <span class="o">%</span> <span class="n">key</span>
        
        <span class="k">for</span> <span class="n">tr</span> <span class="ow">in</span> <span class="n">treatments</span><span class="p">:</span>
            
            <span class="n">arr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">daUniqueFcTable</span><span class="p">[</span><span class="s1">&#39;none&#39;</span><span class="p">][</span><span class="n">tr</span><span class="p">]</span>
            <span class="c1"># we either select the </span>
            <span class="k">if</span> <span class="n">sign</span> <span class="o">==</span> <span class="s1">&#39;positive&#39;</span><span class="p">:</span>
                <span class="n">arr</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">arr</span><span class="p">[:,</span><span class="mi">7</span><span class="p">]</span> <span class="o">==</span>  <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="p">:]</span>
            <span class="k">elif</span> <span class="n">sign</span> <span class="o">==</span> <span class="s1">&#39;negative&#39;</span><span class="p">:</span>
                <span class="n">arr</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">arr</span><span class="p">[:,</span><span class="mi">7</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="p">:]</span>
            
            <span class="k">if</span> <span class="n">sign</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">arr</span><span class="p">[:,</span><span class="mi">9</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">values</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[:,</span><span class="mi">9</span><span class="p">]</span> <span class="o">*</span> <span class="n">arr</span><span class="p">[:,</span><span class="mi">7</span><span class="p">]</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">dsetTopFc</span><span class="p">[</span><span class="n">tr</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="nb">set</span><span class="p">(</span><span class="n">arr</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">values</span> <span class="o">&gt;=</span> <span class="n">threshold</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">])</span>
            <span class="p">)</span>
        
        <span class="n">plot</span><span class="p">[</span><span class="s1">&#39;pdf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">backend_pdf</span><span class="o">.</span><span class="n">PdfPages</span><span class="p">(</span><span class="n">plot</span><span class="p">[</span><span class="s1">&#39;fname&#39;</span><span class="p">])</span>
        <span class="n">plot</span><span class="p">[</span><span class="s1">&#39;fig&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">Figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="n">figsize</span><span class="p">)</span>
        <span class="n">plot</span><span class="p">[</span><span class="s1">&#39;cvs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">backend_pdf</span><span class="o">.</span><span class="n">FigureCanvasPdf</span><span class="p">(</span><span class="n">plot</span><span class="p">[</span><span class="s1">&#39;fig&#39;</span><span class="p">])</span>
        <span class="n">plot</span><span class="p">[</span><span class="s1">&#39;ax&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">plot</span><span class="p">[</span><span class="s1">&#39;fig&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        
        <span class="n">plot</span><span class="p">[</span><span class="s1">&#39;venn&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mplvenn</span><span class="o">.</span><span class="n">venn3</span><span class="p">(</span>
            <span class="n">subsets</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">tr</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dsetTopFc</span><span class="p">[</span><span class="n">tr</span><span class="p">],</span>
                               <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dsetTopFc</span><span class="o">.</span><span class="n">keys</span><span class="p">()))),</span>
            <span class="n">set_labels</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dsetTopFc</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">plot</span><span class="p">[</span><span class="s1">&#39;ax&#39;</span><span class="p">]</span>
        <span class="p">)</span>
        
        <span class="c1"># only in one set</span>
        <span class="k">for</span> <span class="n">tr</span><span class="p">,</span> <span class="n">field_id</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
            <span class="n">treatments</span><span class="p">,</span>
            <span class="p">[</span><span class="s1">&#39;100&#39;</span><span class="p">,</span> <span class="s1">&#39;010&#39;</span><span class="p">,</span> <span class="s1">&#39;001&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;#CC5555&#39;</span><span class="p">,</span> <span class="s1">&#39;#55AA55&#39;</span><span class="p">,</span> <span class="s1">&#39;#5555CC&#39;</span><span class="p">]):</span>
            
            <span class="n">elements</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dsetTopFc</span><span class="p">[</span><span class="n">tr</span><span class="p">]</span>
            <span class="n">othertr</span>   <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">treatments</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">([</span><span class="n">tr</span><span class="p">])</span>
            <span class="n">otherelem</span> <span class="o">=</span> <span class="nb">set</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="o">*</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">otr</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dsetTopFc</span><span class="p">[</span><span class="n">otr</span><span class="p">],</span>
                                         <span class="n">othertr</span><span class="p">))</span>
            <span class="n">elements</span> <span class="o">=</span> <span class="n">elements</span> <span class="o">-</span> <span class="n">otherelem</span>
            <span class="n">set_label_text</span><span class="p">(</span><span class="n">elements</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">field_id</span><span class="p">,</span>
                        <span class="n">number_labels</span><span class="p">,</span> <span class="n">_adj</span> <span class="o">=</span> <span class="n">get_adj</span><span class="p">(</span><span class="n">tr</span><span class="p">))</span>
            <span class="n">plot</span><span class="p">[</span><span class="n">tr</span><span class="p">]</span> <span class="o">=</span> <span class="n">elements</span>
        
        <span class="c1"># intersections of 2 sets</span>
        <span class="k">for</span> <span class="n">pair</span><span class="p">,</span> <span class="n">field_id</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
                <span class="n">itertools</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span><span class="n">treatments</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                <span class="p">[</span><span class="s1">&#39;110&#39;</span><span class="p">,</span> <span class="s1">&#39;101&#39;</span><span class="p">,</span> <span class="s1">&#39;011&#39;</span><span class="p">],</span>
                <span class="p">[</span><span class="s1">&#39;#C0A055&#39;</span><span class="p">,</span> <span class="s1">&#39;#C044C0&#39;</span><span class="p">,</span> <span class="s1">&#39;#44A0C0&#39;</span><span class="p">]</span>
            <span class="p">):</span>
            
            <span class="n">other</span>    <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">treatments</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">pair</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">elements</span> <span class="o">=</span> <span class="nb">set</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="o">*</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">tr</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dsetTopFc</span><span class="p">[</span><span class="n">tr</span><span class="p">],</span> <span class="n">pair</span><span class="p">))</span>
            <span class="n">elements</span> <span class="o">=</span> <span class="n">elements</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">dsetTopFc</span><span class="p">[</span><span class="n">other</span><span class="p">]</span>
            
            <span class="n">set_label_text</span><span class="p">(</span><span class="n">elements</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">field_id</span><span class="p">,</span>
                           <span class="n">number_labels</span><span class="p">,</span> <span class="n">_adj</span> <span class="o">=</span> <span class="n">get_adj</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">:</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">pair</span><span class="p">))</span>
            
            <span class="n">plot</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">:</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">pair</span><span class="p">]</span> <span class="o">=</span> <span class="n">elements</span>
        
        <span class="c1"># intersection of all the 3</span>
        <span class="n">elements</span> <span class="o">=</span> <span class="nb">set</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="o">*</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dsetTopFc</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
        <span class="n">set_label_text</span><span class="p">(</span><span class="n">elements</span><span class="p">,</span> <span class="s1">&#39;#A088A0&#39;</span><span class="p">,</span> <span class="s1">&#39;111&#39;</span><span class="p">,</span>
                       <span class="n">number_labels</span><span class="p">,</span> <span class="n">_adj</span> <span class="o">=</span> <span class="n">get_adj</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">treatments</span><span class="p">)))</span>
        <span class="n">plot</span><span class="p">[</span><span class="s1">&#39;:&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">treatments</span><span class="p">)]</span> <span class="o">=</span> <span class="n">elements</span>
        
        <span class="n">plot</span><span class="p">[</span><span class="s1">&#39;ax&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
        <span class="n">plot</span><span class="p">[</span><span class="s1">&#39;fig&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">rect</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">))</span>
        <span class="c1">#plot[&#39;fig&#39;].subplots_adjust(bottom = 0.2, top = 0.8, right = 0.8, left = 0.2)</span>
        <span class="n">plot</span><span class="p">[</span><span class="s1">&#39;cvs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
        <span class="n">plot</span><span class="p">[</span><span class="s1">&#39;cvs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">print_figure</span><span class="p">(</span><span class="n">plot</span><span class="p">[</span><span class="s1">&#39;pdf&#39;</span><span class="p">])</span>
                                 <span class="c1">#bbox_inches = &#39;tight&#39;,</span>
                                 <span class="c1">#bbox_extra_artists = label_artists)</span>
        <span class="n">plot</span><span class="p">[</span><span class="s1">&#39;pdf&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">plot</span><span class="p">[</span><span class="s1">&#39;fig&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">:: Plot saved to `</span><span class="si">%s</span><span class="s1">`.</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">plot</span><span class="p">[</span><span class="s1">&#39;fname&#39;</span><span class="p">])</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">plotVenn</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">plot</span></div>
    
<div class="viewcode-block" id="Pex100.antibody_id_to_name"><a class="viewcode-back" href="../../index.html#pex100.Pex100.antibody_id_to_name">[docs]</a>    <span class="k">def</span> <span class="nf">antibody_id_to_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aid</span><span class="p">,</span> <span class="n">unique</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        For one antibody ID returns the protein names and residues</span>
<span class="sd">        as a human readable name.</span>
<span class="sd">        If ``unique``, it uses a counter and appends an additional</span>
<span class="sd">        number in parentheses to make a series of labels unique.</span>
<span class="sd">        The counter is under attribute ``cntrUniqueLabels``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">regsymbol</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;([A-Z0-9]*?)([0-9]*[A-Z]?$)&#39;</span><span class="p">)</span>
        <span class="n">repost</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;([0-9]*)([A-Z]*)&#39;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">aid</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>  <span class="n">aid</span> <span class="o">=</span> <span class="p">[</span><span class="n">aid</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">aid</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span> <span class="n">aid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">aid</span><span class="p">)</span>
        
        <span class="k">def</span> <span class="nf">shorten_protein_names</span><span class="p">(</span><span class="n">proteins</span><span class="p">):</span>
            <span class="n">gsymbols</span> <span class="o">=</span> \
                <span class="nb">list</span><span class="p">(</span>
                    <span class="nb">map</span><span class="p">(</span>
                        <span class="k">lambda</span> <span class="n">gs</span><span class="p">:</span>
                            <span class="n">regsymbol</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">gs</span><span class="p">)</span><span class="o">.</span><span class="n">groups</span><span class="p">(),</span>
                        <span class="n">proteins</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            
            <span class="n">stems</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">Counter</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">gs</span><span class="p">:</span> <span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">gsymbols</span><span class="p">))</span>
            
            <span class="n">short</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="nb">sorted</span><span class="p">(</span>
                        <span class="nb">map</span><span class="p">(</span>
                            <span class="k">lambda</span> <span class="n">gss</span><span class="p">:</span>
                                <span class="s1">&#39;</span><span class="si">%s%s%s%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                                    <span class="n">gss</span><span class="p">,</span>
                                    <span class="s1">&#39;[&#39;</span> <span class="k">if</span> <span class="n">stems</span><span class="p">[</span><span class="n">gss</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                                        <span class="nb">sorted</span><span class="p">(</span>
                                            <span class="nb">list</span><span class="p">(</span>
                                                <span class="nb">map</span><span class="p">(</span>
                                                    <span class="k">lambda</span> <span class="n">gs</span><span class="p">:</span>
                                                        <span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                                    <span class="nb">filter</span><span class="p">(</span>
                                                        <span class="k">lambda</span> <span class="n">gs</span><span class="p">:</span>
                                                            <span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">gss</span><span class="p">,</span>
                                                        <span class="n">gsymbols</span>
                                                    <span class="p">)</span>
                                                <span class="p">)</span>
                                            <span class="p">),</span>
                                            <span class="n">key</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">post</span><span class="p">:</span>
                                                <span class="p">(</span>
                                                    <span class="nb">int</span><span class="p">(</span><span class="n">repost</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">post</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
                                                    <span class="k">if</span> <span class="n">repost</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">post</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
                                                    <span class="n">repost</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">post</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
                                                <span class="p">)</span>
                                        <span class="p">)</span>
                                    <span class="p">),</span>
                                    <span class="s1">&#39;]&#39;</span> <span class="k">if</span> <span class="n">stems</span><span class="p">[</span><span class="n">gss</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
                                <span class="p">),</span>
                            <span class="nb">sorted</span><span class="p">(</span><span class="n">stems</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>
            
            <span class="k">return</span> <span class="s1">&#39;Histone H3&#39;</span> <span class="k">if</span> <span class="n">short</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;H3&#39;</span> <span class="k">else</span> <span class="n">short</span>
        
        <span class="n">proteins</span><span class="p">,</span> <span class="n">psites</span> <span class="o">=</span> \
            <span class="nb">list</span><span class="p">(</span>
                <span class="nb">zip</span><span class="p">(</span>
                    <span class="o">*</span><span class="nb">map</span><span class="p">(</span>
                        <span class="k">lambda</span> <span class="n">ps</span><span class="p">:</span>
                            <span class="p">(</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">pa</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">ps</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">,</span> <span class="s1">&#39;genesymbol&#39;</span><span class="p">,</span>
                                                        <span class="n">ncbi_tax_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ncbi_tax_id</span><span class="p">),</span>
                                <span class="p">(</span><span class="n">ps</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">ps</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
                            <span class="p">),</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">aPsiteAnnot</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">in1d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aPsiteAnnot</span><span class="p">[:,</span><span class="mi">5</span><span class="p">],</span> <span class="n">aid</span><span class="p">))]</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>
        
        <span class="n">label</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">-</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">shorten_protein_names</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="o">*</span><span class="n">proteins</span><span class="p">))),</span>
                <span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="nb">map</span><span class="p">(</span>
                        <span class="k">lambda</span> <span class="n">ps</span><span class="p">:</span>
                            <span class="s1">&#39;</span><span class="si">%s%u</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">ps</span><span class="p">,</span>
                        <span class="nb">sorted</span><span class="p">(</span>
                            <span class="nb">set</span><span class="p">(</span><span class="n">psites</span><span class="p">),</span>
                            <span class="n">key</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">ps</span><span class="p">:</span> <span class="n">ps</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>
        
        <span class="k">if</span> <span class="n">unique</span><span class="p">:</span>
            <span class="c1"># labels must be unique</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cntrUniqueLabels</span><span class="o">.</span><span class="n">update</span><span class="p">([</span><span class="n">label</span><span class="p">])</span>
            
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cntrUniqueLabels</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">(</span><span class="si">%u</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cntrUniqueLabels</span><span class="p">[</span><span class="n">label</span><span class="p">])</span>
        
        <span class="k">return</span> <span class="n">label</span></div>
    
    <span class="c1">### Direct functional annotation</span>
    <span class="c1">#</span>
    <span class="c1"># Categories and parent terms:</span>
    <span class="c1">#</span>
    <span class="c1"># -- angiogenesis: GO:0001525</span>
    <span class="c1"># -- neurogenesis: GO:0022008</span>
    <span class="c1">#                  GO:0038179 (neurotrophin signaling pathway)</span>
    <span class="c1"># -- inflammation: GO:0006954</span>
    <span class="c1"># -- lipid metabolism: GO:0006629 or</span>
    <span class="c1">#                      GO:0044255 (cellular lipid metabolic process) or</span>
    <span class="c1">#                      GO:0045444 (fat cell differentiation)</span>
    <span class="c1"># -- survival, cell cycle: GO:0010941 (regulation of cell death) or</span>
    <span class="c1">#                          GO:0007049 (cell cycle)</span>
    <span class="c1">#</span>
    
<div class="viewcode-block" id="Pex100.load_go"><a class="viewcode-back" href="../../index.html#pex100.Pex100.load_go">[docs]</a>    <span class="k">def</span> <span class="nf">load_go</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_reload</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads the GO biological process annotations</span>
<span class="sd">        if those haven&#39;t been loaded or reload forced.</span>
<span class="sd">        Also loads the ontology graph as a</span>
<span class="sd">        ``pysemsim.GOTrees`` object. This is for lookup</span>
<span class="sd">        of ancestors.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="p">(</span>
            <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;dsetGOBP&#39;</span><span class="p">)</span> <span class="ow">and</span>
            <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;dsGONames&#39;</span><span class="p">)</span> <span class="ow">and</span>
            <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;GOOntology&#39;</span><span class="p">)</span> <span class="ow">and</span>
            <span class="ow">not</span> <span class="n">_reload</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>
        
        <span class="n">go</span> <span class="o">=</span> <span class="n">pypath</span><span class="o">.</span><span class="n">dataio</span><span class="o">.</span><span class="n">get_go_quick</span><span class="p">(</span><span class="n">organism</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ncbi_tax_id</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">dsetGOBP</span>    <span class="o">=</span> <span class="n">go</span><span class="p">[</span><span class="s1">&#39;terms&#39;</span><span class="p">][</span><span class="s1">&#39;P&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dsGONames</span> <span class="o">=</span> <span class="n">go</span><span class="p">[</span><span class="s1">&#39;names&#39;</span><span class="p">]</span>
        
        <span class="n">urlObo</span> <span class="o">=</span> <span class="n">pypath</span><span class="o">.</span><span class="n">urls</span><span class="o">.</span><span class="n">urls</span><span class="p">[</span><span class="s1">&#39;go&#39;</span><span class="p">][</span><span class="s1">&#39;url&#39;</span><span class="p">]</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">pypath</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">Curl</span><span class="p">(</span><span class="n">urlObo</span><span class="p">,</span> <span class="n">silent</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">large</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">fnObo</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">fileobj</span><span class="o">.</span><span class="n">name</span>
        <span class="n">c</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">del</span> <span class="n">c</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">GOOntology</span>     <span class="o">=</span> <span class="n">pysemsim</span><span class="o">.</span><span class="n">GOTrees</span><span class="p">(</span><span class="n">fnObo</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dsetGOBPAncestors</span> <span class="o">=</span> <span class="p">(</span>
            <span class="nb">dict</span><span class="p">(</span>
                <span class="nb">map</span><span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">protein</span><span class="p">:</span> <span class="p">(</span>
                        <span class="n">protein</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">terms_with_ancestors</span><span class="p">(</span><span class="n">protein</span><span class="p">)</span>
                    <span class="p">),</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dsetGOBP</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span></div>
    
<div class="viewcode-block" id="Pex100.read_functional_categories"><a class="viewcode-back" href="../../index.html#pex100.Pex100.read_functional_categories">[docs]</a>    <span class="k">def</span> <span class="nf">read_functional_categories</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reread</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads a set of functional categories defined by GO terms.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;dsetFuncCat&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">reread</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">dsetFuncCat</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fnFuncCat</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            
            <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">fp</span><span class="p">:</span>
                
                <span class="n">l</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
                
                <span class="k">if</span> <span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dsetFuncCat</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dsetFuncCat</span><span class="p">[</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
                
                <span class="bp">self</span><span class="o">.</span><span class="n">dsetFuncCat</span><span class="p">[</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span></div>
    
<div class="viewcode-block" id="Pex100.terms_with_ancestors"><a class="viewcode-back" href="../../index.html#pex100.Pex100.terms_with_ancestors">[docs]</a>    <span class="k">def</span> <span class="nf">terms_with_ancestors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">protein</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns all GO terms of one ``protein`` including all their</span>
<span class="sd">        ancestors.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="nb">set</span><span class="p">(</span>
                <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span>
                    <span class="o">*</span><span class="nb">map</span><span class="p">(</span>
                        <span class="k">lambda</span> <span class="n">term</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">GOOntology</span><span class="o">.</span><span class="n">get_ancestors</span><span class="p">(</span><span class="n">term</span><span class="p">),</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">dsetGOBP</span><span class="p">[</span><span class="n">protein</span><span class="p">]</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">dsetGOBP</span><span class="p">[</span><span class="n">protein</span><span class="p">]</span>
        <span class="p">)</span></div>
    
<div class="viewcode-block" id="Pex100.terms_of_category"><a class="viewcode-back" href="../../index.html#pex100.Pex100.terms_of_category">[docs]</a>    <span class="k">def</span> <span class="nf">terms_of_category</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">protein</span><span class="p">,</span> <span class="n">cat</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the terms in one functional category ``cat``</span>
<span class="sd">        one ``protein`` has been annotated with.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dsetGOBPAncestors</span><span class="p">[</span><span class="n">protein</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">dsetFuncCat</span><span class="p">[</span><span class="n">cat</span><span class="p">]</span></div>
    
<div class="viewcode-block" id="Pex100.has_terms_of_category"><a class="viewcode-back" href="../../index.html#pex100.Pex100.has_terms_of_category">[docs]</a>    <span class="k">def</span> <span class="nf">has_terms_of_category</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">protein</span><span class="p">,</span> <span class="n">cat</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns if one ``protein`` has been annotated with any of</span>
<span class="sd">        the terms in one functional category ``cat``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">terms_of_category</span><span class="p">(</span><span class="n">protein</span><span class="p">,</span> <span class="n">cat</span><span class="p">))</span></div>
    
<div class="viewcode-block" id="Pex100.ratio_having_terms_of_category"><a class="viewcode-back" href="../../index.html#pex100.Pex100.ratio_having_terms_of_category">[docs]</a>    <span class="k">def</span> <span class="nf">ratio_having_terms_of_category</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proteins</span><span class="p">,</span> <span class="n">cat</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the ratio of the proteins in list ``proteins``</span>
<span class="sd">        that have been annotated with any terms in category ``cat``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">return</span> <span class="p">(</span>
            <span class="nb">sum</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_terms_of_category</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">cat</span><span class="p">),</span> <span class="n">proteins</span><span class="p">))</span> <span class="o">/</span>
            <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">proteins</span><span class="p">))</span>
        <span class="p">)</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">proteins</span><span class="p">)</span> <span class="k">else</span> <span class="mf">0.0</span></div>
    
<div class="viewcode-block" id="Pex100.functional_array"><a class="viewcode-back" href="../../index.html#pex100.Pex100.functional_array">[docs]</a>    <span class="k">def</span> <span class="nf">functional_array</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compiles an array of functional annotations.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">read_functional_categories</span><span class="p">()</span>
        
        <span class="n">arr</span>    <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">daUniqueFcTable</span><span class="p">[</span><span class="s1">&#39;none&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">cats</span>   <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dsetFuncCat</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">llFunc</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">arr</span><span class="p">:</span>
            
            <span class="n">psite</span>   <span class="o">=</span> <span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
            <span class="n">protein</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            
            <span class="n">effect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">effect_as_int</span><span class="p">(</span><span class="o">*</span><span class="n">psite</span><span class="p">)</span>
            
            <span class="n">self_func</span> <span class="o">=</span> <span class="p">(</span>
                <span class="nb">list</span><span class="p">(</span>
                    <span class="nb">map</span><span class="p">(</span>
                        <span class="k">lambda</span> <span class="n">cat</span><span class="p">:</span>
                            <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">has_terms_of_category</span><span class="p">(</span><span class="n">protein</span><span class="p">,</span> <span class="n">cat</span><span class="p">)),</span>
                        <span class="n">cats</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>
            
            <span class="n">kinases_func</span> <span class="o">=</span> <span class="p">(</span>
                <span class="nb">list</span><span class="p">(</span>
                    <span class="nb">map</span><span class="p">(</span>
                        <span class="k">lambda</span> <span class="n">cat</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">ratio_having_terms_of_category</span><span class="p">(</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">kinases_of_substrate</span><span class="p">(</span><span class="o">*</span><span class="n">psite</span><span class="p">),</span>
                                <span class="n">cat</span>
                            <span class="p">),</span>
                        <span class="n">cats</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>
            
            <span class="n">regulated_func</span> <span class="o">=</span> <span class="p">(</span>
                <span class="nb">list</span><span class="p">(</span>
                    <span class="nb">map</span><span class="p">(</span>
                        <span class="k">lambda</span> <span class="n">cat</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">ratio_having_terms_of_category</span><span class="p">(</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">affected_by</span><span class="p">(</span><span class="o">*</span><span class="n">psite</span><span class="p">),</span>
                                <span class="n">cat</span>
                            <span class="p">),</span>
                        <span class="n">cats</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>
            
            <span class="n">llFunc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="nb">list</span><span class="p">(</span>
                    <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span>
                        <span class="n">psite</span><span class="p">,</span>
                        <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">effect</span><span class="p">],</span>
                        <span class="n">self_func</span><span class="p">,</span>
                        <span class="n">kinases_func</span><span class="p">,</span>
                        <span class="n">regulated_func</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>
            
        
        <span class="n">lHdrFunc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="nb">list</span><span class="p">(</span>
                <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span>
                    <span class="p">[</span><span class="s1">&#39;uniprot&#39;</span><span class="p">,</span> <span class="s1">&#39;resaa&#39;</span><span class="p">,</span> <span class="s1">&#39;resnum&#39;</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">,</span> <span class="s1">&#39;effect&#39;</span><span class="p">],</span>
                    <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">cat</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">;self&#39;</span> <span class="o">%</span> <span class="n">cat</span><span class="p">,</span> <span class="n">cats</span><span class="p">),</span>
                    <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">cat</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">;kinases&#39;</span> <span class="o">%</span> <span class="n">cat</span><span class="p">,</span> <span class="n">cats</span><span class="p">),</span>
                    <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">cat</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">;regulated&#39;</span> <span class="o">%</span> <span class="n">cat</span><span class="p">,</span> <span class="n">cats</span><span class="p">),</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">aFunc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">llFunc</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">object</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lHdrFunc</span> <span class="o">=</span> <span class="n">lHdrFunc</span></div>
    
<div class="viewcode-block" id="Pex100.tidy_functional_array"><a class="viewcode-back" href="../../index.html#pex100.Pex100.tidy_functional_array">[docs]</a>    <span class="k">def</span> <span class="nf">tidy_functional_array</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a tidy array from the functional data and exports it to file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">lHdr</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">,</span> <span class="s1">&#39;func&#39;</span><span class="p">,</span> <span class="s1">&#39;category&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">]</span>
        
        <span class="n">func_of</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;self&#39;</span><span class="p">,</span> <span class="s1">&#39;kinases&#39;</span><span class="p">,</span> <span class="s1">&#39;regulated&#39;</span><span class="p">]</span>
        <span class="n">cats</span>    <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dsetFuncCat</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">result</span>  <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">for</span> <span class="n">icat</span><span class="p">,</span> <span class="n">cat</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cats</span><span class="p">):</span>
            
            <span class="k">for</span> <span class="n">ifun</span><span class="p">,</span> <span class="n">fun</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">func_of</span><span class="p">):</span>
                
                <span class="n">col</span> <span class="o">=</span> <span class="mi">5</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">cats</span><span class="p">)</span> <span class="o">*</span> <span class="n">ifun</span> <span class="o">+</span> <span class="n">icat</span>
                
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">aFunc</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aFunc</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">),</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">cat</span><span class="p">,</span> <span class="n">fun</span><span class="p">]]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">aFunc</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">aFunc</span><span class="p">[:,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">aFunc</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
                    <span class="p">])</span>
                <span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">aTidyFunc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">table_to_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aTidyFunc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fnFuncTidy</span><span class="p">,</span> <span class="n">lHdr</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="Pex100.fc_list"><a class="viewcode-back" href="../../index.html#pex100.Pex100.fc_list">[docs]</a>    <span class="k">def</span> <span class="nf">fc_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">psites</span><span class="p">,</span> <span class="n">treatment</span><span class="p">,</span> <span class="n">signs</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                <span class="n">category</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">std</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns fold change values in one treatment</span>
<span class="sd">        for a list of phosphosites, optionally with</span>
<span class="sd">        signes corrected according to the effect of</span>
<span class="sd">        each phosphosite.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">tbl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">daUniqueFcTable</span><span class="p">[</span><span class="n">std</span><span class="p">][</span><span class="n">treatment</span><span class="p">]</span>
        
        <span class="n">link_methods</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;kinases&#39;</span><span class="p">:</span>   <span class="bp">self</span><span class="o">.</span><span class="n">kinases_of_substrate</span><span class="p">,</span>
            <span class="s1">&#39;regulated&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">affected_by</span>
        <span class="p">}</span>
        
        <span class="k">if</span> <span class="n">category</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">category</span> <span class="o">!=</span> <span class="s1">&#39;self&#39;</span><span class="p">:</span>
            <span class="n">tbl</span> <span class="o">=</span> <span class="n">tbl</span><span class="p">[</span>
                <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                        <span class="nb">list</span><span class="p">(</span>
                            <span class="nb">map</span><span class="p">(</span>
                                <span class="k">lambda</span> <span class="n">r</span><span class="p">:</span>
                                    <span class="nb">bool</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span>
                                        <span class="n">link_methods</span><span class="p">[</span><span class="n">category</span><span class="p">](</span>
                                            <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="mi">4</span><span class="p">]))),</span>
                                <span class="n">tbl</span>
                            <span class="p">)</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                <span class="p">)]</span>
        
        <span class="n">psites</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">psites</span><span class="p">))</span>
        
        <span class="k">if</span> <span class="n">signs</span><span class="p">:</span>
            <span class="n">have_sign</span> <span class="o">=</span> <span class="n">tbl</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">in1d</span><span class="p">(</span><span class="n">tbl</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">tbl</span><span class="p">[:,</span><span class="mi">7</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)][:,</span><span class="mi">5</span><span class="p">],</span> <span class="n">psites</span><span class="p">,</span> <span class="n">assume_unique</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
            <span class="p">)]</span>
            
            <span class="k">return</span> <span class="n">have_sign</span><span class="p">[:,</span><span class="mi">9</span><span class="p">]</span> <span class="o">*</span> <span class="n">have_sign</span><span class="p">[:,</span><span class="mi">7</span><span class="p">]</span>
        
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">tbl</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">in1d</span><span class="p">(</span><span class="n">tbl</span><span class="p">[:,</span><span class="mi">5</span><span class="p">],</span> <span class="n">psites</span><span class="p">,</span> <span class="n">assume_unique</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
            <span class="p">)][:,</span><span class="mi">9</span><span class="p">])</span></div>
    
<div class="viewcode-block" id="Pex100.fc_of_annotated_with"><a class="viewcode-back" href="../../index.html#pex100.Pex100.fc_of_annotated_with">[docs]</a>    <span class="k">def</span> <span class="nf">fc_of_annotated_with</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">annotation</span><span class="p">,</span> <span class="n">treatment</span><span class="p">,</span>
                             <span class="n">signs</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">category</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                             <span class="n">std</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the FC values of from phosphosites in one treatment annotated</span>
<span class="sd">        with a certain functional annotation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">category</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">arr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">aTidyFunc</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aTidyFunc</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">category</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">arr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">aTidyFunc</span>
        
        <span class="n">setAllPsites</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aTidyFunc</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span>
        
        <span class="n">annotated</span> <span class="o">=</span> <span class="p">(</span>
            <span class="nb">set</span><span class="p">(</span>
                <span class="n">arr</span><span class="p">[</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span>
                            <span class="n">arr</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">annotation</span><span class="p">,</span>
                            <span class="n">arr</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                <span class="p">][:,</span><span class="mi">0</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="p">)</span>
        
        <span class="k">return</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fc_list</span><span class="p">(</span><span class="n">annotated</span><span class="p">,</span> <span class="n">treatment</span><span class="p">,</span>
                         <span class="n">signs</span> <span class="o">=</span> <span class="n">signs</span><span class="p">,</span> <span class="n">category</span> <span class="o">=</span> <span class="n">category</span><span class="p">,</span> <span class="n">std</span> <span class="o">=</span> <span class="n">std</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fc_list</span><span class="p">(</span><span class="n">setAllPsites</span> <span class="o">-</span> <span class="n">annotated</span><span class="p">,</span> <span class="n">treatment</span><span class="p">,</span>
                         <span class="n">signs</span> <span class="o">=</span> <span class="n">signs</span><span class="p">,</span> <span class="n">category</span> <span class="o">=</span> <span class="n">category</span><span class="p">,</span> <span class="n">std</span> <span class="o">=</span> <span class="n">std</span><span class="p">)</span>
        <span class="p">)</span></div>
    
<div class="viewcode-block" id="Pex100.functional_compare_fc"><a class="viewcode-back" href="../../index.html#pex100.Pex100.functional_compare_fc">[docs]</a>    <span class="k">def</span> <span class="nf">functional_compare_fc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">annotation</span><span class="p">,</span> <span class="n">treatment</span><span class="p">,</span>
                              <span class="n">silent</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">return_result</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                              <span class="n">signs</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                              <span class="n">category</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                              <span class="n">std</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Performs a Mann-Whitney U-test between fold changes of phosphosites</span>
<span class="sd">        annotated or not with certain functionality.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">aPos</span><span class="p">,</span> <span class="n">aNeg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fc_of_annotated_with</span><span class="p">(</span><span class="n">annotation</span><span class="p">,</span>
                                               <span class="n">treatment</span><span class="p">,</span>
                                               <span class="n">signs</span> <span class="o">=</span> <span class="n">signs</span><span class="p">,</span>
                                               <span class="n">category</span> <span class="o">=</span> <span class="n">category</span><span class="p">,</span>
                                               <span class="n">std</span> <span class="o">=</span> <span class="n">std</span><span class="p">)</span>
        
        <span class="n">fUval</span><span class="p">,</span> <span class="n">fPval</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">mannwhitneyu</span><span class="p">(</span><span class="n">aPos</span><span class="p">,</span> <span class="n">aNeg</span><span class="p">,</span>
                                          <span class="n">alternative</span> <span class="o">=</span> <span class="s1">&#39;two-sided&#39;</span>
                                          <span class="p">)</span>
        
        <span class="n">bGreater</span> <span class="o">=</span> <span class="n">aPos</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">aNeg</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">silent</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">[</span><span class="si">%s</span><span class="s1">] In case of </span><span class="si">%s</span><span class="s1"> treatment, &#39;</span>\
                             <span class="s1">&#39;looking at annotations of `</span><span class="si">%s</span><span class="s1">`,</span><span class="se">\n</span><span class="s1">&#39;</span>\
                             <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">    the fold changes of phosphosites &#39;</span>\
                             <span class="s1">&#39;involved in `</span><span class="si">%s</span><span class="s1">`</span><span class="se">\n</span><span class="s1">&#39;</span>\
                             <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">    are </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">; Mann-Whitney p = </span><span class="si">%.08f</span><span class="s1">; n1 = </span><span class="si">%u</span><span class="s1">, n2 = </span><span class="si">%u</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                                <span class="s1">&#39;S&#39;</span> <span class="k">if</span> <span class="n">fPval</span> <span class="o">&lt;=</span> <span class="mf">0.05</span> <span class="k">else</span> <span class="s1">&#39;N&#39;</span><span class="p">,</span>
                                <span class="n">treatment</span><span class="p">,</span>
                                <span class="s1">&#39;all&#39;</span> <span class="k">if</span> <span class="n">category</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">category</span><span class="p">,</span>
                                <span class="n">annotation</span><span class="p">,</span>
                                <span class="p">(</span><span class="s1">&#39;significantly&#39;</span>
                                 <span class="k">if</span> <span class="n">fPval</span> <span class="o">&lt;=</span> <span class="mf">0.05</span>
                                 <span class="k">else</span> <span class="s1">&#39;not significantly&#39;</span><span class="p">),</span>
                                <span class="s1">&#39;greater&#39;</span> <span class="k">if</span> <span class="n">bGreater</span> <span class="k">else</span> <span class="s1">&#39;lower&#39;</span><span class="p">,</span>
                                <span class="n">fPval</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">aPos</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">aNeg</span><span class="p">)</span>
                            <span class="p">))</span>
        
        <span class="k">if</span> <span class="n">return_result</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">fUval</span><span class="p">,</span> <span class="n">fPval</span><span class="p">,</span> <span class="n">bGreater</span></div>
    
<div class="viewcode-block" id="Pex100.functional_compare_fcs"><a class="viewcode-back" href="../../index.html#pex100.Pex100.functional_compare_fcs">[docs]</a>    <span class="k">def</span> <span class="nf">functional_compare_fcs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">signs</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">std</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compares differences in fold changes across all functional annotations</span>
<span class="sd">        and all treatments.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">for</span> <span class="n">category</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;self&#39;</span><span class="p">,</span> <span class="s1">&#39;kinases&#39;</span><span class="p">,</span> <span class="s1">&#39;regulated&#39;</span><span class="p">]:</span>
            
            <span class="k">for</span> <span class="n">sAnnot</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aTidyFunc</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])):</span>
                
                <span class="k">for</span> <span class="n">sTreat</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">daUniqueFcTable</span><span class="p">[</span><span class="n">std</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                    
                    <span class="bp">self</span><span class="o">.</span><span class="n">functional_compare_fc</span><span class="p">(</span><span class="n">sAnnot</span><span class="p">,</span> <span class="n">sTreat</span><span class="p">,</span>
                                            <span class="n">signs</span> <span class="o">=</span> <span class="n">signs</span><span class="p">,</span>
                                            <span class="n">category</span> <span class="o">=</span> <span class="n">category</span><span class="p">,</span>
                                            <span class="n">std</span> <span class="o">=</span> <span class="n">std</span><span class="p">)</span></div></div>
    
</pre></div>

           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Dénes Türei.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'0.3.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>